<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalkulator Pajak Indonesia</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --navy: #0a1628;
    --navy2: #112240;
    --blue: #1a56db;
    --blue-light: #3b82f6;
    --accent: #f59e0b;
    --accent2: #10b981;
    --red: #ef4444;
    --text: #e2e8f0;
    --text-muted: #94a3b8;
    --muted: #94a3b8;
    --surface: #162032;
    --surface2: #1e2f48;
    --border: rgba(255,255,255,0.08);
    --border-active: rgba(26,86,219,0.5);
    --glow: rgba(26,86,219,0.15);
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: 'Plus Jakarta Sans', sans-serif;
    background: var(--navy);
    color: var(--text);
    min-height: 100vh;
    background-image:
      radial-gradient(ellipse 80% 60% at 50% -10%, rgba(26,86,219,0.12) 0%, transparent 70%),
      radial-gradient(ellipse 40% 30% at 90% 90%, rgba(16,185,129,0.05) 0%, transparent 60%);
  }

  /* HEADER */
  header {
    border-bottom: 1px solid var(--border);
    background: rgba(10,22,40,0.8);
    backdrop-filter: blur(20px);
    position: sticky; top: 0; z-index: 100;
    padding: 0 2rem;
  }
  .header-inner {
    max-width: 1100px; margin: 0 auto;
    display: flex; align-items: center; gap: 1rem;
    height: 64px;
  }
  .logo {
    display: flex; align-items: center; gap: 0.75rem;
  }
  .logo-icon {
    width: 36px; height: 36px;
    background: linear-gradient(135deg, var(--blue), var(--blue-light));
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    box-shadow: 0 0 20px rgba(26,86,219,0.4);
  }
  .logo h1 {
    font-size: 1rem; font-weight: 700;
    color: var(--text); letter-spacing: -0.02em;
  }
  .logo p { font-size: 0.72rem; color: var(--text-muted); }
  .badge {
    margin-left: auto;
    background: rgba(16,185,129,0.15);
    color: var(--accent2);
    border: 1px solid rgba(16,185,129,0.3);
    padding: 3px 10px; border-radius: 99px;
    font-size: 0.72rem; font-weight: 600;
    letter-spacing: 0.05em;
  }

  /* MAIN */
  .main {
    max-width: 1100px; margin: 0 auto;
    padding: 2.5rem 2rem 4rem;
  }

  /* TABS */
  /* â”€â”€ NAVIGASI UTAMA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .nav-bar {
    display: flex; align-items: center; gap: 10px;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  /* Tombol PPh 21 â€” tetap sebagai tab biasa */
  .tab-btn {
    flex-shrink: 0;
    padding: 10px 22px;
    border: 1.5px solid var(--border); cursor: pointer;
    border-radius: 12px;
    font-family: inherit; font-size: 0.88rem; font-weight: 700;
    color: var(--text-muted);
    background: var(--surface2);
    transition: all 0.2s;
    white-space: nowrap;
  }
  .tab-btn:hover { color: var(--text); border-color: var(--accent); }
  .tab-btn.active {
    background: var(--blue);
    color: #fff;
    border-color: var(--blue);
    box-shadow: 0 2px 14px rgba(26,86,219,0.4);
  }

  /* Dropdown pasal lainnya */
  .nav-dropdown-wrap {
    position: relative; flex: 1; min-width: 200px; max-width: 340px;
  }
  .nav-dropdown-btn {
    width: 100%; display: flex; align-items: center; justify-content: space-between;
    gap: 8px; padding: 10px 16px;
    border: 1.5px solid var(--border); border-radius: 12px;
    background: var(--surface2); cursor: pointer;
    font-family: inherit; font-size: 0.88rem; font-weight: 600;
    color: var(--text); transition: all 0.2s;
  }
  .nav-dropdown-btn:hover, .nav-dropdown-btn.open { border-color: var(--accent); }
  .nav-dropdown-btn.active-other { border-color: var(--blue); background: rgba(26,86,219,0.12); color: var(--blue); }
  .nav-dropdown-chevron { font-size: 0.7rem; transition: transform 0.2s; color: var(--muted); }
  .nav-dropdown-btn.open .nav-dropdown-chevron { transform: rotate(180deg); }
  .nav-dropdown-menu {
    display: none; position: absolute; top: calc(100% + 6px); left: 0; right: 0;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; overflow: hidden; z-index: 100;
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
  }
  .nav-dropdown-wrap.open .nav-dropdown-menu { display: block; }
  .nav-dd-item {
    width: 100%; display: flex; align-items: center; gap: 12px;
    padding: 11px 16px; border: none; background: transparent;
    cursor: pointer; font-family: inherit; font-size: 0.87rem;
    font-weight: 600; color: var(--text-muted); text-align: left;
    transition: background 0.15s, color 0.15s;
  }
  .nav-dd-item:hover { background: var(--surface2); color: var(--text); }
  .nav-dd-item.active { background: rgba(26,86,219,0.12); color: var(--blue); }
  .nav-dd-item:not(:last-child) { border-bottom: 1px solid var(--border); }
  .nav-dd-icon { font-size: 1rem; width: 22px; text-align: center; flex-shrink: 0; }
  .nav-dd-label { flex:1; }
  .nav-dd-sub { font-size: 0.72rem; color: var(--muted); font-weight: 400; }

  /* PANELS */
  .panel { display: none; }
  .panel.active { display: block; }

  /* CARD */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 1.5rem;
  }
  .card-title {
    font-size: 0.78rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.1em;
    color: var(--text-muted);
    margin-bottom: 1.25rem;
    display: flex; align-items: center; gap: 0.5rem;
  }
  .card-title::before {
    content: '';
    width: 3px; height: 14px;
    background: var(--blue);
    border-radius: 2px;
    display: inline-block;
  }

  /* GRID */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; }
  @media(max-width: 640px) {
    .grid-2, .grid-3 { grid-template-columns: 1fr; }
  }

  /* FORM */
  .field { display: flex; flex-direction: column; gap: 6px; }
  label {
    font-size: 0.78rem; font-weight: 600;
    color: var(--text-muted); letter-spacing: 0.02em;
  }
  input[type=number], select {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 14px;
    color: var(--text);
    font-family: inherit; font-size: 0.9rem;
    transition: border-color 0.2s, box-shadow 0.2s;
    width: 100%; outline: none;
    appearance: none;
    -webkit-appearance: none;
  }
  select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 36px;
  }
  select option { background: #1e2f48; color: var(--text); }
  input:focus, select:focus {
    border-color: var(--blue-light);
    box-shadow: 0 0 0 3px rgba(26,86,219,0.15);
  }
  input::placeholder { color: var(--text-muted); opacity: 0.5; }

  /* BUTTON */
  .btn {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 12px 28px;
    border: none; cursor: pointer;
    border-radius: 10px;
    font-family: inherit; font-size: 0.9rem; font-weight: 700;
    background: linear-gradient(135deg, var(--blue), var(--blue-light));
    color: #fff;
    transition: all 0.2s;
    box-shadow: 0 4px 15px rgba(26,86,219,0.35);
  }
  .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(26,86,219,0.5);
  }
  .btn:active { transform: translateY(0); }
  .btn-row { margin-top: 1.5rem; }

  /* RESULT */
  .result-box {
    background: linear-gradient(135deg, rgba(26,86,219,0.08), rgba(16,185,129,0.05));
    border: 1px solid rgba(26,86,219,0.25);
    border-radius: 14px;
    padding: 1.5rem;
    margin-top: 1.5rem;
  }
  .result-title {
    font-size: 0.75rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.1em;
    color: var(--blue-light);
    margin-bottom: 1rem;
  }
  .result-table { width: 100%; border-collapse: collapse; }
  .result-table tr { border-bottom: 1px solid rgba(255,255,255,0.05); }
  .result-table tr:last-child { border-bottom: none; }
  .result-table td {
    padding: 8px 0;
    font-size: 0.85rem;
  }
  .result-table td:first-child { color: var(--text-muted); }
  .result-table td:last-child {
    text-align: right;
    font-family: 'DM Mono', monospace;
    color: var(--text);
    font-weight: 500;
  }
  .result-table tr.total td {
    padding-top: 12px;
    font-weight: 700; font-size: 0.95rem;
  }
  .result-table tr.total td:first-child { color: var(--text); }
  .result-table tr.total td:last-child {
    color: var(--accent2);
    font-size: 1.1rem;
  }

  /* TARIF BADGE */
  .tarif-info {
    display: inline-flex; align-items: center; gap: 6px;
    background: rgba(245,158,11,0.1);
    border: 1px solid rgba(245,158,11,0.25);
    color: var(--accent);
    padding: 4px 10px; border-radius: 6px;
    font-size: 0.75rem; font-weight: 600;
    margin-top: 0.5rem;
  }

  /* PTKP PILLS */
  .ptkp-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 8px; margin-top: 6px;
  }
  .ptkp-pill {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 8px 12px;
    cursor: pointer;
    transition: all 0.15s;
    text-align: center;
  }
  .ptkp-pill:hover { border-color: var(--blue-light); }
  .ptkp-pill.selected {
    border-color: var(--blue);
    background: rgba(26,86,219,0.12);
  }
  .ptkp-pill .ptkp-code {
    font-size: 0.8rem; font-weight: 700; color: var(--text);
  }
  .ptkp-pill .ptkp-val {
    font-size: 0.7rem; color: var(--text-muted);
    font-family: 'DM Mono', monospace;
  }

  /* SECTION SUBTITLE */
  .section-header {
    margin-bottom: 2rem;
  }
  .section-header h2 {
    font-size: 1.4rem; font-weight: 800;
    letter-spacing: -0.03em;
    margin-bottom: 0.35rem;
  }
  .section-header p {
    color: var(--text-muted); font-size: 0.85rem;
  }

  /* DIVIDER */
  hr.divider {
    border: none; border-top: 1px solid var(--border);
    margin: 1.5rem 0;
  }

  /* TARIF TABLE */
  .tarif-table {
    width: 100%; border-collapse: collapse;
    font-size: 0.82rem; margin-top: 0.75rem;
  }
  .tarif-table th {
    text-align: left; padding: 8px 12px;
    background: rgba(255,255,255,0.04);
    color: var(--text-muted); font-weight: 600;
    font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.06em;
  }
  .tarif-table td {
    padding: 8px 12px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
  }
  .tarif-table td:last-child { font-family: 'DM Mono', monospace; color: var(--accent); }

  .error-msg {
    color: var(--red);
    font-size: 0.8rem;
    margin-top: 0.5rem;
    display: none;
  }

  /* MODE TOGGLE */
  .mode-toggle {
    display: flex;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 4px;
    gap: 4px;
    width: fit-content;
    margin-bottom: 1.5rem;
  }
  .mode-btn {
    padding: 7px 20px;
    border: none; cursor: pointer;
    border-radius: 7px;
    font-family: inherit; font-size: 0.82rem; font-weight: 600;
    color: var(--text-muted);
    background: transparent;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .mode-btn:hover { color: var(--text); }
  .mode-btn.active {
    background: var(--surface);
    color: var(--text);
    box-shadow: 0 1px 6px rgba(0,0,0,0.3);
  }
  .mode-btn.active.ter { background: linear-gradient(135deg, #7c3aed, #6d28d9); color: #fff; }

  /* â”€â”€ TOGGLE INPUT MODE (per bulan / total setahun) â”€â”€ */
  .input-mode-toggle {
    display: inline-flex; border-radius: 8px; overflow: hidden;
    border: 1px solid var(--border); margin-left: auto;
  }
  .imt-btn {
    padding: 5px 14px; font-size: 0.75rem; font-weight: 600;
    border: none; cursor: pointer; font-family: inherit;
    background: transparent; color: var(--text-muted); transition: all 0.18s;
  }
  .imt-btn.active { background: var(--blue); color: #fff; }
  .card-title-row {
    display: flex; align-items: center; gap: 0.75rem;
    margin-bottom: 1rem;
  }
  .card-title-row .card-title { margin-bottom: 0; }
  .pph21-accordion { display:flex; flex-direction:column; gap:0.5rem; }
  .acc-item { border-radius:14px; border:1px solid var(--border); overflow:hidden; transition:border-color .2s; }
  .acc-item.open { border-color:var(--accent); }
  .acc-header {
    width:100%; display:flex; align-items:center; justify-content:space-between;
    padding:1rem 1.25rem; background:var(--surface2); border:none; cursor:pointer;
    gap:1rem; text-align:left; transition:background .2s;
  }
  .acc-header:hover { background:var(--surface3,#1e2030); }
  .acc-item.open .acc-header { background:rgba(56,139,253,0.07); }
  .acc-header-left { display:flex; align-items:center; gap:0.85rem; }
  .acc-badge {
    width:38px; height:38px; border-radius:10px; display:flex; align-items:center;
    justify-content:center; font-size:1.1rem; flex-shrink:0;
  }
  .acc-badge.ter      { background:rgba(124,58,237,0.18); }
  .acc-badge.umum     { background:rgba(56,139,253,0.18); }
  .acc-badge.nontetap { background:rgba(16,185,129,0.18); }
  .acc-badge.bp       { background:rgba(245,158,11,0.18); }
  .acc-title { font-size:0.95rem; font-weight:700; color:var(--text); }
  .acc-sub   { font-size:0.78rem; color:var(--muted); margin-top:2px; }
  .acc-chevron { font-size:0.8rem; color:var(--muted); flex-shrink:0; transition:transform .25s; }
  .acc-item.open .acc-chevron { transform:rotate(180deg); }
  .acc-body { padding:1.25rem 1.25rem 1.5rem; display:none; border-top:1px solid var(--border); }
  .acc-item.open .acc-body { display:block; }
  .acc-body > .card:first-child,
  .acc-body > .ter-note:first-child { margin-top:0; }

  /* TER KATEGORI BADGE */
  .ter-kat-box {
    background: linear-gradient(135deg, rgba(124,58,237,0.12), rgba(109,40,217,0.06));
    border: 1px solid rgba(124,58,237,0.3);
    border-radius: 12px;
    padding: 1rem 1.25rem;
    margin-top: 0.5rem;
    display: flex; align-items: center; gap: 1rem;
  }
  .ter-kat-badge {
    width: 48px; height: 48px;
    background: linear-gradient(135deg, #7c3aed, #6d28d9);
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.2rem; font-weight: 900;
    color: #fff; flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(124,58,237,0.4);
  }
  .ter-kat-info .ter-kat-label {
    font-size: 0.72rem; color: rgba(167,139,250,0.8);
    font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em;
  }
  .ter-kat-info .ter-kat-desc {
    font-size: 0.85rem; color: var(--text); font-weight: 500; margin-top: 2px;
  }
  .ter-kat-info .ter-kat-rate {
    font-size: 1.4rem; font-weight: 800;
    font-family: 'DM Mono', monospace;
    color: #a78bfa; margin-top: 2px;
    letter-spacing: -0.03em;
  }

  /* TER TABLE COLLAPSIBLE */
  .ter-table-toggle {
    font-size: 0.78rem; color: rgba(167,139,250,0.8);
    cursor: pointer; margin-top: 0.75rem;
    display: flex; align-items: center; gap: 4px;
    background: none; border: none; font-family: inherit;
    font-weight: 600; padding: 0;
  }
  .ter-table-toggle:hover { color: #a78bfa; }
  .ter-table-wrap {
    margin-top: 0.75rem;
    max-height: 0; overflow: hidden;
    transition: max-height 0.3s ease;
  }
  .ter-table-wrap.open { max-height: 600px; }
  .ter-ref-table {
    width: 100%; border-collapse: collapse;
    font-size: 0.78rem;
  }
  .ter-ref-table th {
    text-align: left; padding: 6px 10px;
    background: rgba(124,58,237,0.1);
    color: rgba(167,139,250,0.8); font-weight: 600;
    font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.06em;
  }
  .ter-ref-table td {
    padding: 5px 10px;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    color: var(--text-muted);
  }
  .ter-ref-table tr.ter-active-row td {
    background: rgba(124,58,237,0.12);
    color: var(--text);
    font-weight: 600;
  }
  .ter-ref-table td:last-child {
    font-family: 'DM Mono', monospace;
    color: #a78bfa;
    text-align: right;
  }
  .ter-ref-table tr.ter-active-row td:last-child { color: #c4b5fd; }

  .ter-note {
    background: rgba(245,158,11,0.08);
    border: 1px solid rgba(245,158,11,0.2);
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 0.78rem;
    color: #fcd34d;
    margin-top: 1rem;
  }

  /* TOOLTIP INFO */
  .label-with-info {
    display: flex; align-items: center; gap: 6px;
  }
  .info-icon {
    display: inline-flex; align-items: center; justify-content: center;
    width: 16px; height: 16px;
    background: rgba(59,130,246,0.2);
    border: 1px solid rgba(59,130,246,0.4);
    border-radius: 50%;
    font-size: 0.65rem; font-weight: 800;
    color: var(--blue-light);
    cursor: pointer;
    position: relative;
    flex-shrink: 0;
    transition: background 0.2s;
    font-style: normal;
  }
  .info-icon:hover { background: rgba(59,130,246,0.35); }
  .tooltip-box {
    display: none;
    position: absolute;
    bottom: calc(100% + 8px);
    left: 50%; transform: translateX(-50%);
    width: 280px;
    background: #1e2f48;
    border: 1px solid rgba(59,130,246,0.35);
    border-radius: 10px;
    padding: 12px 14px;
    font-size: 0.78rem;
    color: var(--text);
    font-weight: 400;
    line-height: 1.55;
    box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    z-index: 999;
    font-style: normal;
    text-align: left;
  }
  .tooltip-box::after {
    content: '';
    position: absolute;
    top: 100%; left: 50%; transform: translateX(-50%);
    border: 6px solid transparent;
    border-top-color: rgba(59,130,246,0.35);
  }
  .tooltip-box strong { color: var(--blue-light); display: block; margin-bottom: 5px; }
  .tooltip-box .formula {
    background: rgba(26,86,219,0.1);
    border-radius: 6px; padding: 6px 8px;
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem; color: #93c5fd;
    margin-top: 7px;
  }
  .info-icon:hover .tooltip-box { display: block; }

  /* GROSS UP INFO BOX */
  .grossup-info {
    background: rgba(59,130,246,0.07);
    border: 1px solid rgba(59,130,246,0.2);
    border-radius: 10px;
    padding: 10px 14px;
    font-size: 0.78rem;
    color: #93c5fd;
    margin-top: 0.75rem;
    display: none;
  }
  .grossup-info b { color: var(--blue-light); }

  /* PPH 24 NEGARA ROW */
  .negara-row {
    display: grid; grid-template-columns: 1fr 1fr 1fr auto;
    gap: 0.75rem; align-items: end;
    padding: 1rem 0;
    border-bottom: 1px solid var(--border);
  }
  .negara-row:last-child { border-bottom: none; }
  .negara-row .field label { font-size: 0.72rem; }
  .btn-hapus {
    width: 34px; height: 34px;
    border: 1px solid rgba(239,68,68,0.3);
    background: rgba(239,68,68,0.08);
    border-radius: 8px;
    cursor: pointer; color: #ef4444;
    font-size: 1rem; display: flex;
    align-items: center; justify-content: center;
    transition: all 0.15s; flex-shrink: 0;
  }
  .btn-hapus:hover { background: rgba(239,68,68,0.2); }
  .p24-negara-detail {
    background: rgba(245,158,11,0.06);
    border: 1px solid rgba(245,158,11,0.15);
    border-radius: 10px; padding: 1rem 1.25rem;
    margin-bottom: 0.75rem;
  }
  .p24-negara-detail .negara-nama {
    font-size: 0.78rem; font-weight: 700;
    color: #fbbf24; margin-bottom: 0.5rem;
    text-transform: uppercase; letter-spacing: 0.05em;
  }
  @media(max-width: 640px) {
    .negara-row { grid-template-columns: 1fr 1fr; }
    .negara-row .btn-hapus { grid-column: span 2; width: 100%; height: 32px; }
  }

  /* PPh badan special */
  .pph-badan-result .total-big {
    text-align: center; margin-top: 1rem;
  }
  .pph-badan-result .total-big .label {
    font-size: 0.78rem; color: var(--text-muted); margin-bottom: 4px;
  }
  .pph-badan-result .total-big .amount {
    font-size: 2rem; font-weight: 800;
    font-family: 'DM Mono', monospace;
    color: var(--accent2);
    letter-spacing: -0.04em;
  }
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="logo">
      <div class="logo-icon">ğŸ§¾</div>
      <div>
        <h1>Kalkulator Pajak</h1>
        <p>Team VR â€” Referensi Perhitungan</p>
      </div>
    </div>
    <span class="badge">âš¡ Offline</span>
  </div>
</header>

<div class="main">
  <nav class="nav-bar">
    <div class="nav-dropdown-wrap" id="navDropdownWrap" style="max-width:380px;">
      <button class="nav-dropdown-btn" id="navDropdownBtn" onclick="toggleNavDropdown()">
        <span id="navDropdownLabel">âš¡ PPh 21</span>
        <span class="nav-dropdown-chevron" id="navDropdownChev">â–¼</span>
      </button>
      <div class="nav-dropdown-menu" id="navDropdownMenu">
        <button class="nav-dd-item active" id="ddItem_pph21" onclick="switchTab('pph21', this)">
          <span class="nav-dd-icon">âš¡</span>
          <span class="nav-dd-label">PPh 21<span class="nav-dd-sub"> â€” Gaji, TER, Masa Pajak Terakhir</span></span>
        </button>
        <button class="nav-dd-item" id="ddItem_pph23" onclick="switchTab('pph23', this)">
          <span class="nav-dd-icon">ğŸ’¸</span>
          <span class="nav-dd-label">PPh 23<span class="nav-dd-sub"> â€” Dividen, Bunga, Jasa, Sewa</span></span>
        </button>
        <button class="nav-dd-item" id="ddItem_pph4" onclick="switchTab('pph4', this)">
          <span class="nav-dd-icon">ğŸ </span>
          <span class="nav-dd-label">PPh 4(2)<span class="nav-dd-sub"> â€” Sewa Tanah/Bangunan, Konstruksi</span></span>
        </button>
        <button class="nav-dd-item" id="ddItem_pph15" onclick="switchTab('pph15', this)">
          <span class="nav-dd-icon">ğŸš¢</span>
          <span class="nav-dd-label">PPh 15<span class="nav-dd-sub"> â€” Pelayaran, Penerbangan, Maklon</span></span>
        </button>
        <button class="nav-dd-item" id="ddItem_pphbadan" onclick="switchTab('pphbadan', this)">
          <span class="nav-dd-icon">ğŸ¢</span>
          <span class="nav-dd-label">PPh Badan<span class="nav-dd-sub"> â€” Fasilitas Psl 31E, Tbk</span></span>
        </button>
        <button class="nav-dd-item" id="ddItem_ppn" onclick="switchTab('ppn', this)">
          <span class="nav-dd-icon">ğŸ§¾</span>
          <span class="nav-dd-label">PPN<span class="nav-dd-sub"> â€” PMK 131/2024 Â· PMK 11/2025</span></span>
        </button>
        <button class="nav-dd-item" id="ddItem_ppnbm" onclick="switchTab('ppnbm', this)">
          <span class="nav-dd-icon">ğŸš—</span>
          <span class="nav-dd-label">PPnBM<span class="nav-dd-sub"> â€” Barang Mewah</span></span>
        </button>
        <button class="nav-dd-item" id="ddItem_pph24" onclick="switchTab('pph24', this)">
          <span class="nav-dd-icon">ğŸŒ</span>
          <span class="nav-dd-label">PPh 24<span class="nav-dd-sub"> â€” Kredit Pajak Luar Negeri</span></span>
        </button>
        <button class="nav-dd-item" id="ddItem_pph26" onclick="switchTab('pph26', this)">
          <span class="nav-dd-icon">âœˆï¸</span>
          <span class="nav-dd-label">PPh 26<span class="nav-dd-sub"> â€” WPLN / Tax Treaty</span></span>
        </button>
      </div>
    </div>
  </nav>

  <!-- PPH 21 -->
  <div id="pph21" class="panel active">
    <div class="section-header">
      <h2>PPh Pasal 21</h2>
      <p>Pajak Penghasilan atas penghasilan berupa gaji, upah, honorarium, dan pembayaran lain.</p>
    </div>

    <!-- ACCORDION PPH 21 -->
    <div class="pph21-accordion">

      <!-- acc_ter -->
      <div class="acc-item open" id="acc_ter">
        <button class="acc-header" onclick="setMode('ter')">
          <div class="acc-header-left">
            <span class="acc-badge ter">âš¡</span>
            <div>
              <div class="acc-title">TER â€” Tarif Efektif Rata-Rata</div>
              <div class="acc-sub">Pegawai Tetap Â· Masa Januariâ€“November Â· Dipotong tiap bulan</div>
            </div>
          </div>
          <span class="acc-chevron" id="chev_ter">â–¼</span>
        </button>
        <div class="acc-body" id="body_ter" style="display:block">
<div class="card">
        <div class="card-title">Data Pegawai & PTKP</div>
        <div class="grid-2">
          <div class="field">
            <label>Status PTKP</label>
            <select id="ter_ptkp" onchange="hitungTER()">
              <option value="A_54000000">TK/0 â€” Rp 54.000.000 (Kategori A)</option>
              <option value="B_58500000">TK/1 â€” Rp 58.500.000 (Kategori B)</option>
              <option value="B_63000000">TK/2 â€” Rp 63.000.000 (Kategori B)</option>
              <option value="B_67500000">TK/3 â€” Rp 67.500.000 (Kategori B)</option>
              <option value="B_58500000_k0">K/0 â€” Rp 58.500.000 (Kategori B)</option>
              <option value="C_63000000">K/1 â€” Rp 63.000.000 (Kategori C)</option>
              <option value="C_67500000">K/2 â€” Rp 67.500.000 (Kategori C)</option>
              <option value="C_72000000">K/3 â€” Rp 72.000.000 (Kategori C)</option>
            </select>
          </div>
          <div class="field">
            <label>Masa Pajak</label>
            <select id="ter_masa">
              <option value="1">Januari</option>
              <option value="2">Februari</option>
              <option value="3">Maret</option>
              <option value="4">April</option>
              <option value="5">Mei</option>
              <option value="6">Juni</option>
              <option value="7">Juli</option>
              <option value="8">Agustus</option>
              <option value="9">September</option>
              <option value="10">Oktober</option>
              <option value="11">November</option>
            </select>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Penghasilan Bruto Bulan Ini</div>
        <div class="grid-2">
          <div class="field">
            <label>Gaji Pokok (Rp)</label>
            <input type="number" id="ter_gaji" placeholder="0" oninput="hitungTER()">
          </div>
          <div class="field">
            <label>Tunjangan Lainnya (Rp)</label>
            <input type="number" id="ter_tunjangan" placeholder="0" oninput="hitungTER()">
          </div>
          <div class="field">
            <label>Bonus / THR bulan ini (Rp)</label>
            <input type="number" id="ter_bonus" placeholder="0" oninput="hitungTER()">
          </div>
          <div class="field">
            <label>Premi Asuransi Perusahaan (Rp)</label>
            <input type="number" id="ter_premi" placeholder="0" oninput="hitungTER()">
          </div>
        </div>

        <!-- TER Kategori info box -->
        <div class="ter-kat-box" id="ter_kat_box" style="display:none">
          <div class="ter-kat-badge" id="ter_kat_huruf">A</div>
          <div class="ter-kat-info">
            <div class="ter-kat-label">TER Kategori <span id="ter_kat_nama">A</span></div>
            <div class="ter-kat-desc" id="ter_kat_desc">TK/0 â€” Tidak Kawin, Tanpa Tanggungan</div>
            <div class="ter-kat-rate">Tarif: <span id="ter_rate_display">0%</span></div>
          </div>
        </div>

        <!-- Ref table toggle -->
        <button class="ter-table-toggle" id="ter_toggle_btn" onclick="toggleTerTable()" style="display:none">
          <span id="ter_toggle_icon">â–¶</span> Lihat Tabel Tarif TER Lengkap
        </button>
        <div class="ter-table-wrap" id="ter_table_wrap">
          <table class="ter-ref-table" id="ter_ref_table"></table>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Skema Penghitungan</div>
        <div class="grid-2">
          <div class="field">
            <label class="label-with-info">
              Metode Penanggung PPh
              <i class="info-icon" id="ter_gu_icon" style="display:none">i
                <div class="tooltip-box">
                  <strong>ğŸ’¡ Gross Up TER</strong>
                  Perusahaan menambah tunjangan pajak sehingga nilai PPh TER = tunjangan PPh. Bruto bertambah, sehingga TER rate bisa naik bracket â€” dihitung iteratif.
                  <div class="formula">Bruto baru = Bruto asli + Tunjangan PPh<br>TER Ã— Bruto baru = Tunjangan PPh</div>
                </div>
              </i>
            </label>
            <select id="ter_skema" onchange="hitungTER()">
              <option value="gross">Gross â€” Karyawan Tanggung PPh</option>
              <option value="netto">Netto â€” Perusahaan Tanggung PPh</option>
              <option value="gross_up">Gross Up â€” Perusahaan Beri Tunjangan PPh</option>
            </select>
            <div class="grossup-info" id="ter_gu_box" style="display:none">
              â„¹ï¸ <b>Gross Up:</b> Tunjangan PPh ditambahkan ke bruto. Take home karyawan = gaji pokok asli. Biaya perusahaan = gaji + tunjangan PPh.
            </div>
            <div class="grossup-info" id="ter_netto_box" style="display:none; border-color:rgba(16,185,129,0.3); background:rgba(16,185,129,0.06); color:#6ee7b7;">
              â„¹ï¸ <b>Netto:</b> Karyawan menerima gaji penuh. PPh ditanggung &amp; dibayar langsung oleh perusahaan (bukan dipotong dari gaji).
            </div>
          </div>
        </div>
      </div>

      <div class="ter-note">
        âš ï¸ <strong>Catatan TER:</strong> Berlaku untuk masa Januariâ€“November (PMK 168/2023). PPh 21 masa Desember dihitung dengan metode umum (tahunan). Tarif TER dikenakan langsung atas penghasilan bruto sebulan.
      </div>

      <div class="result-box" id="resultTER" style="display:none; margin-top:1.5rem; border-color: rgba(124,58,237,0.3); background: linear-gradient(135deg, rgba(124,58,237,0.08), rgba(109,40,217,0.04))">
        <div class="result-title" style="color:#a78bfa">âš¡ Hasil Perhitungan PPh 21 â€” Metode TER</div>
        <table class="result-table" id="tableTER"></table>
      </div>
        </div><!-- /body_ter -->
      </div><!-- /acc_ter -->
      <!-- acc_umum -->
      <div class="acc-item" id="acc_umum">
        <button class="acc-header" onclick="setMode('umum')">
          <div class="acc-header-left">
            <span class="acc-badge umum">ğŸ“…</span>
            <div>
              <div class="acc-title">Masa Pajak Terakhir</div>
              <div class="acc-sub">Pegawai Tetap Â· Desember atau masa resign/pensiun Â· Tarif Psl 17</div>
            </div>
          </div>
          <span class="acc-chevron" id="chev_umum">â–¼</span>
        </button>
        <div class="acc-body" id="body_umum" style="display:none">
<div class="ter-note" style="margin-bottom:1rem;">
        ğŸ“‹ <strong>Masa Pajak Terakhir (PMK 168/2023):</strong> Khusus <b>Pegawai Tetap</b>. Berlaku untuk masa Desember (full year) atau masa terakhir jika pegawai resign/pensiun/meninggal di tengah tahun. PPh dihitung ulang secara tahunan menggunakan Tarif Pasal 17, dikurangi PPh yang sudah dipotong via TER bulan-bulan sebelumnya.
      </div>

      <div class="card">
        <div class="card-title">Data Pegawai Tetap</div>
        <div class="grid-2">
          <div class="field">
            <label>Status PTKP</label>
            <select id="pph21_ptkp" onchange="hitung21()">
              <option value="54000000">TK/0 â€” Rp 54.000.000</option>
              <option value="58500000">TK/1 â€” Rp 58.500.000</option>
              <option value="63000000">TK/2 â€” Rp 63.000.000</option>
              <option value="67500000">TK/3 â€” Rp 67.500.000</option>
              <option value="58500000_k">K/0 â€” Rp 58.500.000</option>
              <option value="63000000_k">K/1 â€” Rp 63.000.000</option>
              <option value="67500000_k">K/2 â€” Rp 67.500.000</option>
              <option value="72000000_k">K/3 â€” Rp 72.000.000</option>
            </select>
          </div>
          <div class="field">
            <label class="label-with-info">
              Skenario Masa Kerja
              <i class="info-icon">i
                <div class="tooltip-box">
                  <strong>Skenario A â€” Dari Januari:</strong> Bekerja sejak Jan (atau sudah bekerja di perusahaan ini sejak tahun lalu). Penghasilan aktual tidak disetahunkan.<br><br>
                  <strong>Skenario B â€” Mulai Tengah Tahun:</strong> Baru mulai bekerja di perusahaan ini di pertengahan tahun, tetapi sudah SPDN sejak 1 Januari. Penghasilan disetahunkan lalu dikalikan proporsi bulan.
                </div>
              </i>
            </label>
            <select id="pph21_skenario" onchange="toggleSkenario(); hitung21()">
              <option value="A">Skenario A â€” Bekerja dari Januari (atau resign tengah tahun)</option>
              <option value="B">Skenario B â€” Mulai bekerja pertengahan tahun</option>
            </select>
          </div>
          <div class="field" id="field_bulan_mulai" style="display:none">
            <label>Bulan Mulai Bekerja</label>
            <select id="pph21_bulan_mulai" onchange="hitung21()">
              <option value="2">Februari</option><option value="3">Maret</option>
              <option value="4">April</option><option value="5">Mei</option>
              <option value="6">Juni</option><option value="7">Juli</option>
              <option value="8">Agustus</option><option value="9">September</option>
              <option value="10">Oktober</option><option value="11">November</option>
              <option value="12">Desember</option>
            </select>
          </div>
          <div class="field">
            <label>Bulan Masa Pajak Terakhir</label>
            <select id="pph21_bulan_terakhir" onchange="hitung21()">
              <option value="1">Januari</option><option value="2">Februari</option>
              <option value="3">Maret</option><option value="4">April</option>
              <option value="5">Mei</option><option value="6">Juni</option>
              <option value="7">Juli</option><option value="8">Agustus</option>
              <option value="9">September</option><option value="10">Oktober</option>
              <option value="11">November</option><option value="12" selected>Desember</option>
            </select>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title-row">
          <div class="card-title">Komponen Penghasilan</div>
          <div class="input-mode-toggle">
            <button class="imt-btn active" id="imt_bulan" onclick="setInputMode21('bulan')">Per Bulan</button>
            <button class="imt-btn" id="imt_setahun" onclick="setInputMode21('setahun')">Total Setahun</button>
          </div>
        </div>
        <div class="grid-2">
          <div class="field">
            <label id="lbl21_gaji">Gaji Pokok per Bulan (Rp)</label>
            <input type="number" id="pph21_gaji" placeholder="0" oninput="hitung21()">
          </div>
          <div class="field">
            <label id="lbl21_tunj">Tunjangan Lainnya per Bulan (Rp)</label>
            <input type="number" id="pph21_tunjangan" placeholder="0" oninput="hitung21()">
          </div>
          <div class="field">
            <label id="lbl21_premi">Premi Asuransi Dibayar Perusahaan per Bulan (Rp)</label>
            <input type="number" id="pph21_premi" placeholder="0" oninput="hitung21()">
          </div>
          <div class="field">
            <label>Bonus / THR â€” Total (Rp)</label>
            <input type="number" id="pph21_bonus" placeholder="0" oninput="hitung21()">
          </div>
          <div class="field">
            <label id="lbl21_iuran">Iuran Pensiun / JHT per Bulan (Rp)</label>
            <input type="number" id="pph21_iuran" placeholder="0" oninput="hitung21()">
          </div>
          <div class="field">
            <label class="label-with-info">
              PPh 21 Sudah Dipotong Sebelumnya (Rp)
              <i class="info-icon">i
                <div class="tooltip-box">
                  Total PPh 21 yang sudah dipotong via TER dari bulan pertama s.d. bulan sebelum masa pajak terakhir. Isi 0 jika masa pajak terakhir = Januari atau belum ada pemotongan sebelumnya.
                </div>
              </i>
            </label>
            <input type="number" id="pph21_pph_dipotong" placeholder="0" oninput="hitung21()">
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Skema Penghitungan</div>
        <div class="grid-2">
          <div class="field">
            <label class="label-with-info">
              Metode Penanggung PPh
              <i class="info-icon" id="grossup_info_icon" style="display:none">i
                <div class="tooltip-box">
                  <strong>ğŸ’¡ Gross Up Masa Pajak Terakhir</strong>
                  Perusahaan menambahkan tunjangan PPh ke penghasilan masa terakhir sehingga nilai tunjangan = PPh masa terakhir yang harus dibayar.
                  <div class="formula">Cari T: PPh_terutang(bruto + T) âˆ’ PPh_dipotong = T<br>â†’ dihitung iteratif</div>
                </div>
              </i>
            </label>
            <select id="pph21_skema" onchange="toggleGrossUpInfo21(); hitung21()">
              <option value="gross">Gross â€” Karyawan Tanggung PPh</option>
              <option value="netto">Netto â€” Perusahaan Tanggung PPh</option>
              <option value="gross_up">Gross Up â€” Perusahaan Beri Tunjangan PPh</option>
            </select>
            <div class="grossup-info" id="grossup_info_box" style="display:none">
              â„¹ï¸ <b>Gross Up:</b> Tunjangan PPh ditambah ke gaji masa terakhir. Take home karyawan = gaji asli masa terakhir. PPh masa terakhir = tunjangan yang diberikan.
            </div>
            <div class="grossup-info" id="grossup_netto_box" style="display:none; border-color:rgba(16,185,129,0.3); background:rgba(16,185,129,0.06); color:#6ee7b7;">
              â„¹ï¸ <b>Netto:</b> Karyawan terima gaji penuh. PPh masa terakhir ditanggung &amp; dibayar langsung oleh perusahaan.
            </div>
          </div>
        </div>
      </div>

      <div class="result-box" id="result21" style="display:none">
        <div class="result-title">ğŸ“Š Hasil Perhitungan PPh 21 â€” Pegawai Tetap Masa Pajak Terakhir</div>
        <table class="result-table" id="table21"></table>
      </div>
        </div><!-- /body_umum -->
      </div><!-- /acc_umum -->
      <!-- acc_nontetap -->
      <div class="acc-item" id="acc_nontetap">
        <button class="acc-header" onclick="setMode('nontetap')">
          <div class="acc-header-left">
            <span class="acc-badge nontetap">ğŸ”§</span>
            <div>
              <div class="acc-title">Pegawai Tidak Tetap</div>
              <div class="acc-sub">Upah Harian / Bulanan Â· TER Harian &amp; Bulanan Â· PMK 168/2023</div>
            </div>
          </div>
          <span class="acc-chevron" id="chev_nontetap">â–¼</span>
        </button>
        <div class="acc-body" id="body_nontetap" style="display:none">
<div class="card">
        <div class="card-title">Jenis Upah</div>
        <div class="grid-2">
          <div class="field">
            <label>Jenis</label>
            <select id="nt_jenis" onchange="hitungNonTetap()">
              <option value="ptt_harian">Upah Harian</option>
              <option value="ptt_bulanan">Upah Bulanan</option>
            </select>
          </div>
          <div class="field">
            <label>Status PTKP</label>
            <select id="nt_ptkp" onchange="hitungNonTetap()">
              <option value="54000000">TK/0 â€” Rp 54.000.000</option>
              <option value="58500000">TK/1 â€” Rp 58.500.000</option>
              <option value="63000000">TK/2 â€” Rp 63.000.000</option>
              <option value="67500000">TK/3 â€” Rp 67.500.000</option>
              <option value="58500000_k">K/0 â€” Rp 58.500.000</option>
              <option value="63000000_k">K/1 â€” Rp 63.000.000</option>
              <option value="67500000_k">K/2 â€” Rp 67.500.000</option>
              <option value="72000000_k">K/3 â€” Rp 72.000.000</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Skema Tidak Tetap -->
      <div class="card">
        <div class="card-title">Skema Penghitungan</div>
        <div class="grid-2">
          <div class="field">
            <label class="label-with-info">
              Metode Penanggung PPh
              <i class="info-icon" id="nt_gu_icon" style="display:none">i
                <div class="tooltip-box">
                  <strong>ğŸ’¡ Gross Up Tidak Tetap</strong>
                  Perusahaan menaikkan upah harian/bulanan sehingga setelah PPh dipotong, pekerja menerima upah asli.
                  <div class="formula">Harian: Upah baru = Upah asli + PPh(Upah baru)<br>Bulanan: iteratif seperti pegawai tetap</div>
                </div>
              </i>
            </label>
            <select id="nt_skema" onchange="hitungNonTetap()">
              <option value="gross">Gross â€” Karyawan Tanggung PPh</option>
              <option value="netto">Netto â€” Perusahaan Tanggung PPh</option>
              <option value="gross_up">Gross Up â€” Perusahaan Beri Tunjangan PPh</option>
            </select>
            <div class="grossup-info" id="nt_gu_box" style="display:none">
              â„¹ï¸ <b>Gross Up:</b> Upah dinaikkan agar take home karyawan = upah asli setelah PPh dipotong.
            </div>
            <div class="grossup-info" id="nt_netto_box" style="display:none; border-color:rgba(16,185,129,0.3); background:rgba(16,185,129,0.06); color:#6ee7b7;">
              â„¹ï¸ <b>Netto:</b> Karyawan terima upah penuh. PPh ditanggung &amp; dibayar langsung oleh perusahaan.
            </div>
          </div>
        </div>
      </div>
      <div class="card" id="nt_card_harian">
        <div class="card-title">Data Upah Harian</div>
        <div class="grid-2">
          <div class="field">
            <label>Upah per Hari (Rp)</label>
            <input type="number" id="nt_upah_hari" placeholder="Contoh: 500000" oninput="hitungNonTetap()">
          </div>
          <div class="field">
            <label>Jumlah Hari Kerja Bulan Ini</label>
            <input type="number" id="nt_hari_kerja" placeholder="Contoh: 10" oninput="hitungNonTetap()">
          </div>
        </div>
        <div class="ter-note" style="margin-top:0.75rem; margin-bottom:0">
          â„¹ï¸ <strong>TER Harian PMK 168/2023 â€” Kode Objek Pajak Coretax:</strong><br>
          <b>21-100-24:</b> â‰¤ Rp450.000/hari â†’ <b>0%</b> (tidak dipotong) &nbsp;|&nbsp; Rp450.001â€“Rp2.500.000/hari â†’ <b>0,5% Ã— upah harian</b><br>
          <b>21-100-30:</b> &gt; Rp2.500.000/hari â†’ <b>Tarif Psl 17 Ã— 50% Ã— upah harian</b> (DPP 50%, sama seperti Bukan Pegawai)
        </div>
      </div>

      <!-- Upah Bulanan -->
      <div class="card" id="nt_card_bulanan" style="display:none">
        <div class="card-title">Data Upah Bulanan â€” Kode Coretax 21-100-35</div>
        <div class="grid-2">
          <div class="field">
            <label>Penghasilan Bruto Sebulan (Rp)</label>
            <input type="number" id="nt_upah_bulanan" placeholder="0" oninput="hitungNonTetap()">
          </div>
          <div class="field">
            <label>Iuran Pensiun / JHT per Bulan (Rp)</label>
            <input type="number" id="nt_iuran_bulanan" placeholder="0" oninput="hitungNonTetap()">
          </div>
        </div>
        <div class="ter-note" style="margin-top:0.75rem; margin-bottom:0">
          â„¹ï¸ <b>21-100-35 â€” Upah PTT Bulanan:</b> Dipotong menggunakan <b>TER Bulanan</b> setiap bulan (kategori A/B/C berdasarkan PTKP). Tidak ada rekonsiliasi tahunan oleh pemotong. DPP = penghasilan bruto sebulan.
        </div>
      </div>

      <div class="result-box" id="resultNonTetap" style="display:none; margin-top:1.5rem; border-color:rgba(16,185,129,0.3); background:linear-gradient(135deg,rgba(16,185,129,0.06),rgba(5,150,105,0.03))">
        <div class="result-title" style="color:#34d399">ğŸ”§ Hasil Perhitungan PPh 21 â€” Pegawai Tidak Tetap</div>
        <table class="result-table" id="tableNonTetap"></table>
      </div>
        </div><!-- /body_nontetap -->
      </div><!-- /acc_nontetap -->
      <!-- acc_bp -->
      <div class="acc-item" id="acc_bp">
        <button class="acc-header" onclick="setMode('bp')">
          <div class="acc-header-left">
            <span class="acc-badge bp">ğŸ‘¤</span>
            <div>
              <div class="acc-title">Bukan Pegawai</div>
              <div class="acc-sub">Tenaga Ahli, Peserta Kegiatan &amp; Honorarium Â· Tarif Psl 17 Ã— DPP Â· PMK 168/2023</div>
            </div>
          </div>
          <span class="acc-chevron" id="chev_bp">â–¼</span>
        </button>
        <div class="acc-body" id="body_bp" style="display:none">
<div class="ter-note" style="margin-bottom:1rem;">
        ğŸ“‹ <strong>PMK 168/2023 â€” Bukan Pegawai:</strong> Tidak lagi dibedakan berkesinambungan vs tidak berkesinambungan. Tidak ada lagi penghitungan kumulatif antar bulan. <b>Rumus tunggal: PPh = Tarif Psl 17 Ã— (50% Ã— Penghasilan Bruto)</b> per masa pajak/pembayaran.
      </div>

      <div class="card">
        <div class="card-title">Identitas & Jenis Bukan Pegawai</div>
        <div class="grid-2">
          <div class="field">
            <label>Jenis Bukan Pegawai (Kode Objek Pajak Coretax)</label>
            <select id="bp_jenis" onchange="hitungBP()">
              <optgroup label="â”€â”€ Deemed 50% Ã— Bruto (DPP = 50%) â”€â”€">
                <option value="21-100-07">21-100-07 | Tenaga Ahli (Pengacara, Akuntan, Arsitek, Dokter, Konsultan, Notaris, PPAT, Penilai, Aktuaris)</option>
                <option value="21-100-07-rs">21-100-07 | Dokter â€” Jasa dari RS/Klinik (bruto = jasa sebelum dipotong RS)</option>
                <option value="21-100-33">21-100-33 | Seniman, Artis, Presenter, Sutradara, Kru Film, Influencer, Selebgram, Vlogger, Blogger</option>
                <option value="21-100-34">21-100-34 | Olahragawan</option>
                <option value="21-100-18">21-100-18 | Penasihat, Pengajar, Pelatih, Penceramah, Penyuluh, Moderator</option>
                <option value="21-100-19">21-100-19 | Pengarang, Peneliti, Penerjemah</option>
                <option value="21-100-20">21-100-20 | Pemberi Jasa dalam Segala Bidang</option>
                <option value="21-100-21">21-100-21 | Agen Iklan</option>
                <option value="21-100-22">21-100-22 | Pengawas atau Pengelola Proyek</option>
                <option value="21-100-23">21-100-23 | Pembawa Pesanan / Perantara / Makelar</option>
                <option value="21-100-06">21-100-06 | Petugas Penjaja Barang Dagangan</option>
                <option value="21-100-05">21-100-05 | Agen Asuransi</option>
                <option value="21-100-04">21-100-04 | Distributor Pemasaran Berjenjang / Penjualan Langsung</option>
              </optgroup>
              <optgroup label="â”€â”€ Deemed 100% Ã— Bruto (DPP = 100%) â”€â”€">
                <option value="21-100-36">21-100-36 | Peserta Perlombaan (Olahraga, Seni, Ketangkasan, IPTEK, dll)</option>
                <option value="21-100-14">21-100-14 | Peserta Rapat, Konferensi, Sidang, Seminar, Lokakarya, Kunjungan Kerja</option>
                <option value="21-100-15">21-100-15 | Peserta / Anggota Kepanitiaan Penyelenggara Kegiatan</option>
                <option value="21-100-16">21-100-16 | Peserta Pendidikan, Pelatihan, dan Magang</option>
                <option value="21-100-17">21-100-17 | Peserta Kegiatan Lainnya</option>
                <option value="21-100-12">21-100-12 | Peserta Program Pensiun (Masih Pegawai) â€” Penarikan Dana Pensiun Sebagian</option>
              </optgroup>
            </select>
          </div>

          <div class="field">
            <label class="label-with-info">
              Metode Penanggung PPh
              <i class="info-icon" id="bp_gu_icon" style="display:none">i
                <div class="tooltip-box">
                  <strong>ğŸ’¡ Gross Up Bukan Pegawai</strong>
                  Pemberi kerja menaikkan honorarium sehingga setelah PPh dipotong, bukan pegawai tetap menerima nilai asli yang diinginkan.
                  <div class="formula">Honorarium baru = H asli + PPh(H baru)<br>PPh = Tarif Psl 17 Ã— 50% Ã— H baru â€” dihitung iteratif</div>
                </div>
              </i>
            </label>
            <select id="bp_skema" onchange="hitungBP()">
              <option value="gross">Gross â€” Bukan Pegawai Tanggung PPh</option>
              <option value="netto">Netto â€” Pemberi Kerja Tanggung PPh</option>
              <option value="gross_up">Gross Up â€” Honorarium Dinaikkan</option>
            </select>
            <div class="grossup-info" id="bp_gu_box" style="display:none">
              â„¹ï¸ <b>Gross Up:</b> Honorarium dinaikkan sehingga setelah PPh dipotong, bukan pegawai tetap menerima nilai bruto asli.
            </div>
            <div class="grossup-info" id="bp_netto_box" style="display:none; border-color:rgba(16,185,129,0.3); background:rgba(16,185,129,0.06); color:#6ee7b7;">
              â„¹ï¸ <b>Netto:</b> Bukan pegawai menerima penuh nilai bruto. PPh ditanggung &amp; dibayar langsung oleh pemberi kerja.
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Data Penghasilan</div>
        <div class="grid-2">
          <div class="field">
            <label id="bp_bruto_label">Penghasilan Bruto (Rp)</label>
            <input type="number" id="bp_bruto" placeholder="0" oninput="hitungBP()">
          </div>
        </div>

        <div class="card" id="bp_dokter_note" style="display:none; background:rgba(245,158,11,0.07); border:1px solid rgba(245,158,11,0.3); margin-top:1rem;">
          <div style="font-size:0.82rem; color:#fbbf24;">
            ğŸ¥ <strong>Khusus Dokter RS/Klinik (21-100-07):</strong> Penghasilan bruto = jasa dokter yang dibayar pasien ke RS <em>sebelum</em> dipotong/dibagi hasil oleh RS. Bukan nilai yang sudah diterima bersih dokter.
          </div>
        </div>
        <div class="card" id="bp_dpp100_note" style="display:none; background:rgba(59,130,246,0.07); border:1px solid rgba(59,130,246,0.3); margin-top:1rem;">
          <div style="font-size:0.82rem; color:#93c5fd;">
            â„¹ï¸ <strong>DPP = 100% Bruto:</strong> Untuk jenis ini, Dasar Pengenaan Pajak = <b>seluruh penghasilan bruto</b> (bukan 50%). Tarif Psl 17 dikenakan atas bruto penuh. Tidak ada pengurangan deemed expense.
          </div>
        </div>
      </div>

      <div class="result-box" id="resultBP" style="display:none; margin-top:1.5rem; border-color:rgba(245,158,11,0.3); background:linear-gradient(135deg,rgba(245,158,11,0.06),rgba(251,191,36,0.03))">
        <div class="result-title" style="color:#fbbf24">ğŸ‘¤ Hasil Perhitungan PPh 21 â€” Bukan Pegawai (PMK 168/2023)</div>
        <table class="result-table" id="tableBP"></table>
      </div>
        </div><!-- /body_bp -->
      </div><!-- /acc_bp -->

    </div><!-- /pph21-accordion -->
  </div><!-- /panel pph21 -->

  <!-- PPH 23 -->
  <div id="pph23" class="panel">
    <div class="section-header">
      <h2>PPh Pasal 23</h2>
      <p>Pajak atas dividen, bunga, royalti, hadiah, sewa, dan jasa tertentu.</p>
    </div>

    <div class="card">
      <div class="card-title">Detail Transaksi</div>
      <div class="grid-2">
        <div class="field">
          <label>Jenis Penghasilan</label>
          <select id="pph23_jenis" onchange="hitung23()">
            <optgroup label="â”€â”€ 15% â€” Dividen / Bunga / Royalti / Hadiah â”€â”€">
              <option value="24-101-01|15">24-101-01 | Dividen</option>
              <option value="24-102-01|15">24-102-01 | Bunga (selain PPh 4(2))</option>
              <option value="24-103-01|15">24-103-01 | Royalti</option>
              <option value="24-100-01|15">24-100-01 | Hadiah / Penghargaan / Bonus</option>
            </optgroup>
            <optgroup label="â”€â”€ 2% â€” Sewa Harta â”€â”€">
              <option value="24-100-02|2">24-100-02 | Sewa Harta (selain Tanah/Bangunan)</option>
            </optgroup>
            <optgroup label="â”€â”€ 2% â€” Jasa â”€â”€">
              <option value="24-104-01|2">24-104-01 | Jasa Teknik</option>
              <option value="24-104-02|2">24-104-02 | Jasa Manajemen</option>
              <option value="24-104-03|2">24-104-03 | Jasa Konsultan</option>
              <option value="24-104-04|2">24-104-04 | Jasa Penilai (Appraisal)</option>
              <option value="24-104-05|2">24-104-05 | Jasa Aktuaris</option>
              <option value="24-104-06|2">24-104-06 | Jasa Akuntansi / Pembukuan / Atestasi</option>
              <option value="24-104-07|2">24-104-07 | Jasa Hukum</option>
              <option value="24-104-08|2">24-104-08 | Jasa Arsitektur</option>
              <option value="24-104-09|2">24-104-09 | Jasa Perencanaan Kota &amp; Arsitektur Landscape</option>
              <option value="24-104-10|2">24-104-10 | Jasa Perancang (Design)</option>
              <option value="24-104-11|2">24-104-11 | Jasa Pengeboran (Drilling) â€” Migas, bukan BUT</option>
              <option value="24-104-12|2">24-104-12 | Jasa Penunjang â€” Panas Bumi &amp; Migas</option>
              <option value="24-104-13|2">24-104-13 | Jasa Penambangan &amp; Penunjang Panas Bumi/Migas</option>
              <option value="24-104-14|2">24-104-14 | Jasa Penunjang Penerbangan &amp; Bandar Udara</option>
              <option value="24-104-15|2">24-104-15 | Jasa Penebangan Hutan</option>
              <option value="24-104-16|2">24-104-16 | Jasa Pengolahan Limbah</option>
              <option value="24-104-17|2">24-104-17 | Jasa Penyedia Tenaga Kerja / Outsourcing</option>
              <option value="24-104-18|2">24-104-18 | Jasa Perantara / Keagenan</option>
              <option value="24-104-19|2">24-104-19 | Jasa Perdagangan Surat Berharga (selain Bursa)</option>
              <option value="24-104-20|2">24-104-20 | Jasa Kustodian / Penyimpanan / Penitipan</option>
              <option value="24-104-21|2">24-104-21 | Jasa Pengisian Suara (Dubbing) / Sulih Suara</option>
              <option value="24-104-22|2">24-104-22 | Jasa Mixing Film</option>
              <option value="24-104-23|2">24-104-23 | Jasa Pembuatan Sarana Promosi (Film, Iklan, Poster, Banner)</option>
              <option value="24-104-24|2">24-104-24 | Jasa Software / Hardware / Sistem Komputer</option>
              <option value="24-104-25|2">24-104-25 | Jasa Pembuatan / Pengelolaan Website</option>
              <option value="24-104-26|2">24-104-26 | Jasa Internet</option>
              <option value="24-104-27|2">24-104-27 | Jasa Penyimpanan / Pengolahan / Penyaluran Data</option>
              <option value="24-104-28|2">24-104-28 | Jasa Instalasi/Pemasangan Mesin, Listrik, Telepon (non-konstruksi)</option>
              <option value="24-104-29|2">24-104-29 | Jasa Perawatan/Perbaikan Mesin, Listrik, AC, TV Kabel (non-konstruksi)</option>
              <option value="24-104-30|2">24-104-30 | Jasa Perawatan Kendaraan / Alat Transportasi</option>
              <option value="24-104-31|2">24-104-31 | Jasa Maklon</option>
              <option value="24-104-32|2">24-104-32 | Jasa Penyelidikan &amp; Keamanan</option>
              <option value="24-104-33|2">24-104-33 | Jasa Penyelenggara Kegiatan / Event Organizer</option>
              <option value="24-104-34|2">24-104-34 | Jasa Penyediaan Tempat/Waktu di Media / Jasa Periklanan</option>
              <option value="24-104-35|2">24-104-35 | Jasa Pembasmian Hama</option>
              <option value="24-104-36|2">24-104-36 | Jasa Kebersihan / Cleaning Service</option>
              <option value="24-104-37|2">24-104-37 | Jasa Sedot Septic Tank</option>
              <option value="24-104-38|2">24-104-38 | Jasa Pemeliharaan Kolam</option>
              <option value="24-104-39|2">24-104-39 | Jasa Katering / Tata Boga</option>
              <option value="24-104-40|2">24-104-40 | Jasa Freight Forwarding</option>
              <option value="24-104-41|2">24-104-41 | Jasa Logistik</option>
              <option value="24-104-42|2">24-104-42 | Jasa Pengurusan Dokumen</option>
              <option value="24-104-43|2">24-104-43 | Jasa Pengepakan</option>
              <option value="24-104-44|2">24-104-44 | Jasa Loading &amp; Unloading</option>
              <option value="24-104-45|2">24-104-45 | Jasa Laboratorium / Pengujian</option>
              <option value="24-104-46|2">24-104-46 | Jasa Pengelolaan Parkir</option>
              <option value="24-104-47|2">24-104-47 | Jasa Penyondiran Tanah</option>
              <option value="24-104-48|2">24-104-48 | Jasa Penyiapan / Pengolahan Lahan</option>
              <option value="24-104-49|2">24-104-49 | Jasa Pembibitan / Penanaman Bibit</option>
              <option value="24-104-50|2">24-104-50 | Jasa Pemeliharaan Tanaman</option>
              <option value="24-104-51|2">24-104-51 | Jasa Pemanenan</option>
              <option value="24-104-52|2">24-104-52 | Jasa Pengolahan Hasil Pertanian / Perkebunan / Perikanan</option>
              <option value="24-104-53|2">24-104-53 | Jasa Dekorasi</option>
              <option value="24-104-54|2">24-104-54 | Jasa Pencetakan / Penerbitan</option>
              <option value="24-104-55|2">24-104-55 | Jasa Penerjemahan</option>
              <option value="24-104-56|2">24-104-56 | Jasa Pengangkutan / Ekspedisi (selain PPh 15)</option>
              <option value="24-104-57|2">24-104-57 | Jasa Pelayanan Pelabuhan</option>
              <option value="24-104-58|2">24-104-58 | Jasa Pengangkutan Melalui Jalur Pipa</option>
              <option value="24-104-59|2">24-104-59 | Jasa Pengelolaan Penitipan Anak</option>
              <option value="24-104-60|2">24-104-60 | Jasa Pelatihan / Kursus</option>
              <option value="24-104-61|2">24-104-61 | Jasa Pengiriman &amp; Pengisian Uang ke ATM</option>
              <option value="24-104-62|2">24-104-62 | Jasa Sertifikasi</option>
              <option value="24-104-63|2">24-104-63 | Jasa Survey</option>
              <option value="24-104-64|2">24-104-64 | Jasa Tester</option>
              <option value="24-104-65|2">24-104-65 | Jasa Lainnya dibebanka pada APBN/APBD</option>
              <option value="24-104-66|2">24-104-66 | Jasa Penyelenggaraan Layanan Distribusi Token</option>
              <option value="24-104-67|2">24-104-67 | Jasa Pemasaran dengan Media Voucher</option>
              <option value="24-104-68|2">24-104-68 | Jasa Distribusi Voucher (Penyelenggara &amp; Distributor)</option>
              <option value="24-104-69|2">24-104-69 | Jasa Program Loyalitas / Reward Pelanggan</option>
            </optgroup>
            <optgroup label="â”€â”€ 0% (Bebas / Dikecualikan) â”€â”€">
              <option value="24-105-01|0">24-105-01 | Bunga Pinjaman P2P Lending (dikecualikan)</option>
              <option value="24-106-01|0">24-106-01 | Kontraktor Utama â€” Proyek Pemerintah Hibah/PLN</option>
            </optgroup>
          </select>
        </div>
        <div class="field">
          <label class="label-with-info">
            Skema Penghitungan
            <i class="info-icon" id="pph23_gu_icon" style="display:none">i
              <div class="tooltip-box">
                <strong>ğŸ’¡ Gross Up PPh 23</strong>
                Pemberi penghasilan menaikkan nilai bruto sehingga penerima tetap menerima nilai yang diinginkan setelah pajak dipotong.
                <div class="formula">Bruto = Neto Ã· (1 âˆ’ Tarif)</div>
              </div>
            </i>
          </label>
          <select id="pph23_skema" onchange="hitung23()">
            <option value="gross">Gross â€” Penerima Tanggung Pajak</option>
            <option value="netto">Netto â€” Pemberi Tanggung Pajak</option>
            <option value="gross_up">Gross Up â€” Bruto Dinaikkan agar Neto Terjaga</option>
          </select>
        </div>
        <div class="field" id="pph23_input_wrap">
          <label id="pph23_input_label">Penghasilan Bruto (Rp)</label>
          <input type="number" id="pph23_bruto" placeholder="0" oninput="hitung23()">
        </div>
      </div>
      <div class="tarif-info" id="pph23_tarif_info">Tarif: 15%</div>
      <div class="grossup-info" id="pph23_gu_box" style="display:none">
        â„¹ï¸ <b>Gross Up:</b> Input nilai neto yang ingin diterima penerima. Bruto dihitung otomatis = Neto Ã· (1 âˆ’ Tarif).
      </div>
      <div class="grossup-info" id="pph23_netto_box" style="display:none; border-color:rgba(16,185,129,0.3); background:rgba(16,185,129,0.06); color:#6ee7b7;">
        â„¹ï¸ <b>Netto:</b> Input penghasilan bruto. PPh ditanggung pemberi â€” penerima terima penuh nilai bruto.
      </div>
    </div>

    <div class="result-box" id="result23" style="display:none">
      <div class="result-title">ğŸ“Š Hasil Perhitungan PPh 23</div>
      <table class="result-table" id="table23"></table>
    </div>
  </div>

  <!-- PPH 4(2) -->
  <div id="pph4" class="panel">
    <div class="section-header">
      <h2>PPh Pasal 4 Ayat (2)</h2>
      <p>Pajak bersifat final atas penghasilan tertentu seperti sewa, bunga deposito, dan konstruksi.</p>
    </div>

    <div class="card">
      <div class="card-title">Detail Transaksi</div>
      <div class="grid-2">
        <div class="field">
          <label>Jenis Penghasilan</label>
          <select id="pph4_jenis" onchange="hitung4()">
            <optgroup label="â”€â”€ Sewa &amp; Pengalihan Tanah/Bangunan â”€â”€">
              <option value="28-403-02|10">28-403-02 | Sewa Tanah dan/atau Bangunan (10%)</option>
              <option value="28-402-01|2.5">28-402-01 | Pengalihan Hak atas Tanah/Bangunan (2,5%)</option>
              <option value="28-402-02|1">28-402-02 | Pengalihan Rumah Sederhana / Rusun Sederhana (1%)</option>
            </optgroup>
            <optgroup label="â”€â”€ Bunga Deposito &amp; Tabungan â”€â”€">
              <option value="28-404-01|20">28-404-01 | Bunga Tabungan &amp; Deposito â€” Selain DHE (20%)</option>
              <option value="28-404-09|20">28-404-09 | Bunga Deposito/Tabungan â€” Ditempatkan di LN (20%)</option>
              <option value="28-404-02|7.5">28-404-02 | Bunga Deposito IDR dari DHE â€” tenor 1 bulan (7,5%)</option>
              <option value="28-404-03|5">28-404-03 | Bunga Deposito IDR dari DHE â€” tenor 3 bulan (5%)</option>
              <option value="28-404-04|0">28-404-04 | Bunga Deposito IDR dari DHE â€” tenor â‰¥ 6 bulan (0%)</option>
              <option value="28-404-05|10">28-404-05 | Bunga Deposito USD dari DHE â€” tenor 1 bulan (10%)</option>
              <option value="28-404-06|7.5">28-404-06 | Bunga Deposito USD dari DHE â€” tenor 3 bulan (7,5%)</option>
              <option value="28-404-07|2.5">28-404-07 | Bunga Deposito USD dari DHE â€” tenor 6 bulan (2,5%)</option>
              <option value="28-404-08|0">28-404-08 | Bunga Deposito USD dari DHE â€” tenor &gt; 6 bulan (0%)</option>
              <option value="28-404-10|20">28-404-10 | Diskonto Sertifikat Bank Indonesia (20%)</option>
              <option value="28-404-11|20">28-404-11 | Jasa Giro (20%)</option>
            </optgroup>
            <optgroup label="â”€â”€ Obligasi &amp; Surat Utang â”€â”€">
              <option value="28-401-01|15">28-401-01 | Bunga Obligasi / SUN / Obligasi Daerah â€” WPDN &amp; BUT (15%)</option>
              <option value="28-401-03|10">28-401-03 | Bunga Obligasi WPDN &amp; BUT â€” diadministrasikan BI (10%)</option>
              <option value="28-401-06|10">28-401-06 | Bunga Obligasi WPDN &amp; BUT (10%)</option>
              <option value="28-401-04|20">28-401-04 | Diskonto SPN â€” WPDN &amp; BUT (20%)</option>
              <option value="28-401-05|20">28-401-05 | Diskonto SPN â€” WP LN (20%)</option>
            </optgroup>
            <optgroup label="â”€â”€ Saham â”€â”€">
              <option value="28-406-01|0.1">28-406-01 | Penjualan Saham di Bursa (Bukan Pendiri) (0,1%)</option>
              <option value="28-407-01|0.5">28-407-01 | Penjualan Saham Pendiri di Bursa (0,5%)</option>
              <option value="28-408-01|0.1">28-408-01 | Penjualan Saham Modal Ventura â€” Tidak di Bursa (0,1%)</option>
            </optgroup>
            <optgroup label="â”€â”€ Dividen &amp; Hadiah â”€â”€">
              <option value="28-419-01|10">28-419-01 | Dividen yang Diterima WP OP Dalam Negeri (10%)</option>
              <option value="28-405-01|25">28-405-01 | Hadiah Undian (25%)</option>
              <option value="28-417-01|10">28-417-01 | Bunga Simpanan Koperasi â€” WP OP (10%)</option>
            </optgroup>
            <optgroup label="â”€â”€ Jasa Konstruksi (PP 9/2022) â”€â”€">
              <option value="28-409-22|1.75">28-409-22 | Konstruksi â€” Pelaksanaan, Kualifikasi Kecil / Sertifikat OP (1,75%)</option>
              <option value="28-409-24|2.65">28-409-24 | Konstruksi â€” Pelaksanaan, Kualifikasi Selain Kecil (2,65%)</option>
              <option value="28-409-23|4">28-409-23 | Konstruksi â€” Pelaksanaan, Tanpa Sertifikat (4%)</option>
              <option value="28-409-25|2.65">28-409-25 | Konstruksi Terintegrasi â€” Dengan Sertifikat BU (2,65%)</option>
              <option value="28-409-26|4">28-409-26 | Konstruksi Terintegrasi â€” Tanpa Sertifikat (4%)</option>
              <option value="28-409-27|3.5">28-409-27 | Konsultansi Konstruksi â€” Dengan Sertifikat (3,5%)</option>
              <option value="28-409-28|6">28-409-28 | Konsultansi Konstruksi â€” Tanpa Sertifikat (6%)</option>
            </optgroup>
            <optgroup label="â”€â”€ PPh Final UMKM â€” PP 55/2022 â”€â”€">
              <option value="28-423-01|0.5">28-423-01 | UMKM â€” Peredaran Bruto Tertentu, tarif 0,5% (PP 23/2018 / PP 55/2022)</option>
              <option value="28-423-03|0.5">28-423-03 | UMKM OP â€” s.d. Rp 500 Juta: tarif 0,5% atas kelebihan 500 Juta</option>
              <option value="28-423-14|0.5">28-423-14 | UMKM â€” Proyek Pemerintah dibiayai Hibah / PLN (0,5%)</option>
            </optgroup>
            <optgroup label="â”€â”€ Lainnya â”€â”€">
              <option value="28-499-02|7.5">28-499-02 | Kerja Sama dengan LPI (7,5%)</option>
              <option value="28-421-01|20">28-421-01 | Uplift Hulu Migas (20%)</option>
            </optgroup>
          </select>
        </div>
        <div class="field">
          <label class="label-with-info">
            Skema Penghitungan
            <i class="info-icon" id="pph4_gu_icon" style="display:none">i
              <div class="tooltip-box">
                <strong>ğŸ’¡ Gross Up PPh 4(2)</strong>
                Pemotong menaikkan nilai bruto agar penerima tetap menerima nilai neto yang diinginkan setelah pajak final dipotong.
                <div class="formula">Bruto = Neto Ã· (1 âˆ’ Tarif)</div>
              </div>
            </i>
          </label>
          <select id="pph4_skema" onchange="hitung4()">
            <option value="gross">Gross â€” Penerima Tanggung Pajak</option>
            <option value="netto">Netto â€” Pemotong Tanggung Pajak</option>
            <option value="gross_up">Gross Up â€” Bruto Dinaikkan agar Neto Terjaga</option>
          </select>
        </div>
        <div class="field">
          <label id="pph4_input_label">Penghasilan Bruto / Nilai Transaksi (Rp)</label>
          <input type="number" id="pph4_bruto" placeholder="0" oninput="hitung4()">
        </div>
      </div>
      <div class="tarif-info" id="pph4_tarif_info">Tarif: 10% (Final)</div>
      <div class="grossup-info" id="pph4_gu_box" style="display:none">
        â„¹ï¸ <b>Gross Up:</b> Input nilai neto yang ingin diterima penerima. Bruto dihitung otomatis = Neto Ã· (1 âˆ’ Tarif).
      </div>
      <div class="grossup-info" id="pph4_netto_box" style="display:none; border-color:rgba(16,185,129,0.3); background:rgba(16,185,129,0.06); color:#6ee7b7;">
        â„¹ï¸ <b>Netto:</b> Input penghasilan bruto. PPh final ditanggung pemotong â€” penerima terima penuh nilai bruto.
      </div>
    </div>

    <div class="result-box" id="result4" style="display:none">
      <div class="result-title">ğŸ“Š Hasil Perhitungan PPh 4(2) â€” Final</div>
      <table class="result-table" id="table4"></table>
    </div>
  </div>

  <!-- PPH 15 -->
  <div id="pph15" class="panel">
    <div class="section-header">
      <h2>PPh Pasal 15</h2>
      <p>Pajak penghasilan dengan norma penghitungan khusus untuk WP pelayaran, penerbangan internasional, dan perusahaan asing.</p>
    </div>

    <div class="card">
      <div class="card-title">Jenis & Tarif PPh 15</div>
      <table class="tarif-table">
        <tr><th>Jenis WP</th><th>Norma Penghasilan Neto</th><th>Tarif PPh</th><th>PPh Efektif</th></tr>
        <tr><td>Pelayaran Dalam Negeri</td><td>4% dari peredaran bruto</td><td>1,2% Ã— PPh</td><td>1,2%</td></tr>
        <tr><td>Penerbangan Dalam Negeri (charter)</td><td>6% dari peredaran bruto</td><td>PPh normal</td><td>1,8%</td></tr>
        <tr><td>Pelayaran / Penerbangan Luar Negeri</td><td>6% dari peredaran bruto</td><td>2,64% efektif</td><td>2,64%</td></tr>
        <tr><td>WP LN â€” Kantor Perwakilan Dagang</td><td>1% dari nilai ekspor bruto</td><td>0,44% efektif</td><td>0,44%</td></tr>
        <tr><td>Jasa Maklon Mainan Anak (Internasional)</td><td>7% dari biaya pembuatan</td><td>PPh normal</td><td>~1,75%</td></tr>
      </table>
    </div>

    <div class="card">
      <div class="card-title">Detail Transaksi</div>
      <div class="grid-2">
        <div class="field">
          <label>Jenis WP / Usaha</label>
          <select id="p15_jenis" onchange="hitungP15()">
            <optgroup label="â”€â”€ Pelayaran Dalam Negeri (1,2%) â”€â”€">
              <option value="28-410-01|1.2">28-410-01 | Pelayaran DN â€” Pengangkutan Orang/Barang / Sewa Kapal (disetor sendiri)</option>
              <option value="28-410-02|1.2">28-410-02 | Pelayaran DN â€” Imbalan dari Pemotong Pihak Lain</option>
            </optgroup>
            <optgroup label="â”€â”€ Pelayaran / Penerbangan Luar Negeri â”€â”€">
              <option value="28-411-02|2.64">28-411-02 | Charter Kapal Laut / Pesawat â€” Perusahaan LN melalui BUT (2,64%)</option>
              <option value="28-411-01|0">28-411-01 | Pelayaran / Penerbangan LN â€” Pengangkutan Orang/Barang Reguler (0%)</option>
            </optgroup>
            <optgroup label="â”€â”€ Penerbangan Dalam Negeri (1,8%) â”€â”€">
              <option value="penerbangan_dn|1.8">PPh 15 | Penerbangan Dalam Negeri / Charter (1,8%) â€” norma 6% Ã— tarif PPh</option>
            </optgroup>
            <optgroup label="â”€â”€ Perwakilan Dagang Luar Negeri (0,44%) â”€â”€">
              <option value="28-413-01|0.44">28-413-01 | Kantor Perwakilan Dagang WPLN di Indonesia (0,44%)</option>
            </optgroup>
            <optgroup label="â”€â”€ Jasa Maklon Internasional (1,75%) â”€â”€">
              <option value="maklon|1.75">PPh 15 | Jasa Maklon Internasional â€” Mainan Anak (7% Ã— 25% = 1,75%)</option>
            </optgroup>
          </select>
        </div>
        <div class="field">
          <label class="label-with-info">
            Skema Penghitungan
            <i class="info-icon" id="p15_gu_icon" style="display:none">i
              <div class="tooltip-box">
                <strong>ğŸ’¡ Gross Up PPh 15</strong>
                Nilai imbalan dinaikkan sehingga penerima menerima nilai bersih yang diinginkan setelah PPh 15 dipotong.
                <div class="formula">Bruto = Neto Ã· (1 âˆ’ Tarif Efektif)</div>
              </div>
            </i>
          </label>
          <select id="p15_skema" onchange="hitungP15()">
            <option value="gross">Gross â€” Penerima Tanggung Pajak</option>
            <option value="netto">Netto â€” Pemberi Tanggung Pajak</option>
            <option value="gross_up">Gross Up â€” Imbalan Dinaikkan</option>
          </select>
        </div>
        <div class="field">
          <label id="p15_input_label">Peredaran Bruto / Imbalan (Rp)</label>
          <input type="number" id="p15_bruto" placeholder="0" oninput="hitungP15()">
        </div>
      </div>
      <div class="tarif-info" id="p15_tarif_info">Tarif Efektif: 1,2%</div>
      <div class="grossup-info" id="p15_gu_box" style="display:none">
        â„¹ï¸ <b>Gross Up:</b> Input nilai neto yang ingin diterima. Imbalan bruto dihitung otomatis.
      </div>
      <div class="grossup-info" id="p15_netto_box" style="display:none; border-color:rgba(16,185,129,0.3); background:rgba(16,185,129,0.06); color:#6ee7b7;">
        â„¹ï¸ <b>Netto:</b> Penerima terima penuh. PPh 15 ditanggung pemberi.
      </div>
    </div>

    <div class="result-box" id="resultP15" style="display:none">
      <div class="result-title">ğŸ“Š Hasil Perhitungan PPh 15</div>
      <table class="result-table" id="tableP15"></table>
    </div>
  </div>

  <!-- PPH BADAN -->
  <div id="pphbadan" class="panel">
    <div class="section-header">
      <h2>PPh Badan</h2>
      <p>Pajak penghasilan untuk Wajib Pajak Badan (perusahaan / badan usaha).</p>
    </div>

    <div class="card">
      <div class="card-title">Tarif yang Berlaku</div>
      <table class="tarif-table">
        <tr><th>Kategori</th><th>Tarif</th></tr>
        <tr><td>Peredaran bruto â‰¤ Rp 4,8 M (Pasal 31E â€” bagian yang memperoleh fasilitas)</td><td>11%</td></tr>
        <tr><td>Peredaran bruto â‰¤ Rp 4,8 M (bagian tanpa fasilitas)</td><td>22%</td></tr>
        <tr><td>Peredaran bruto Rp 4,8 M â€” Rp 50 M (proporsional)</td><td>11% + 22%</td></tr>
        <tr><td>Peredaran bruto > Rp 50 M</td><td>22%</td></tr>
        <tr><td>Perusahaan Tbk (go public, syarat terpenuhi)</td><td>19%</td></tr>
      </table>
    </div>

    <div class="card">
      <div class="card-title">Data Perusahaan</div>
      <div class="grid-2">
        <div class="field">
          <label>Peredaran Bruto Setahun (Rp)</label>
          <input type="number" id="pb_peredaran" placeholder="Contoh: 3000000000" oninput="hitungBadan()">
        </div>
        <div class="field">
          <label>Penghasilan Kena Pajak (Rp)</label>
          <input type="number" id="pb_pkp" placeholder="Contoh: 500000000" oninput="hitungBadan()">
        </div>
        <div class="field">
          <label>Jenis Badan</label>
          <select id="pb_jenis" onchange="hitungBadan()">
            <option value="biasa">WP Badan Biasa</option>
            <option value="tbk">Perusahaan Tbk (Go Public)</option>
          </select>
        </div>
      </div>
    </div>

    <div class="result-box" id="resultBadan" style="display:none">
      <div class="result-title">ğŸ“Š Hasil Perhitungan PPh Badan</div>
      <table class="result-table" id="tableBadan"></table>
    </div>
  </div>

  <!-- PPN -->
  <div id="ppn" class="panel">
    <div class="section-header">
      <h2>PPN â€” Pajak Pertambahan Nilai</h2>
      <p>Pajak atas konsumsi barang dan jasa di dalam wilayah Indonesia. Berlaku PMK 131/2024 mulai 1 Januari 2025.</p>
    </div>

    <!-- Skema Pilihan -->
    <div class="card">
      <div class="card-title">Skema DPP</div>
      <div class="grid-2">
        <div class="field">
          <label class="label-with-info">
            Jenis DPP
            <i class="info-icon">i
              <div class="tooltip-box" style="width:280px">
                <strong>PMK 131/2024 (berlaku 1 Jan 2025):</strong><br>
                <b>â€¢ BKP/JKP Non-Mewah:</b> DPP Nilai Lain = 11/12 Ã— Harga â†’ PPN efektif 11%<br>
                <b>â€¢ BKP Mewah (PPnBM):</b> DPP = Harga Jual penuh â†’ PPN 12% langsung<br><br>
                <b>DPP Nilai Lain Besaran Tertentu</b> berlaku untuk jenis usaha khusus berdasarkan PMK tersendiri.
              </div>
            </i>
          </label>
          <select id="ppn_skema" onchange="switchPPNSkema()">
            <option value="non_mewah">BKP/JKP Non-Mewah â€” DPP Nilai Lain 11/12 (Efektif 11%)</option>
            <option value="mewah">BKP Mewah (PPnBM) â€” DPP Harga Jual Penuh (12%)</option>
            <option value="ekspor">Ekspor BKP/JKP â€” Tarif 0%</option>
            <option value="nilai_lain">Besaran Tertentu (PMK 11/2025)</option>
          </select>
        </div>

        <div class="field" id="ppn_nilailain_field" style="display:none">
          <label>Jenis Transaksi (PMK 11/2025)</label>
          <select id="ppn_nilailain_jenis" onchange="hitungPPN()">
            <optgroup label="â”€â”€ Jasa KP Tertentu â€” Efektif 1,1% â”€â”€">
              <option value="jasa_pengiriman">Jasa Pengiriman Paket â€” 10% Ã— 11/12 Ã— 12%</option>
              <option value="biro_perjalanan">Jasa Biro/Agen Perjalanan Wisata â€” 10% Ã— 11/12 Ã— 12%</option>
              <option value="freight_forwarding">Jasa Pengurusan Transportasi / Freight Forwarding â€” 10% Ã— 11/12 Ã— 12%</option>
              <option value="voucher_marketing">Jasa Penyelenggaraan Pemasaran dg Voucer â€” 10% Ã— 11/12 Ã— 12%</option>
              <option value="ibadah_dirinci">Jasa Perjalanan Ibadah (Tagihan Dirinci) â€” 10% Ã— 11/12 Ã— 12%</option>
              <option value="ibadah_tidakdirinci">Jasa Perjalanan Ibadah (Tagihan Tidak Dirinci) â€” 5% Ã— 11/12 Ã— 12%</option>
            </optgroup>
            <optgroup label="â”€â”€ Emas Perhiasan (PMK 48/2023) â”€â”€">
              <option value="emas_konsumen">Emas ke Konsumen Akhir (Pabrikan/Pedagang) â€” 15% Ã— 11/12 Ã— 12% = efektif 1,65%</option>
              <option value="emas_antar_pkp">Emas Antar PKP (Pabrikanâ†”Pedagang) â€” 10% Ã— 11/12 Ã— 12% = efektif 1,1%</option>
            </optgroup>
            <optgroup label="â”€â”€ BKP Tertentu â”€â”€">
              <option value="pertanian">Barang Hasil Pertanian Tertentu â€” 10% Ã— 11/12 Ã— 12% = efektif 1,1%</option>
              <option value="kendaraan_bekas">Kendaraan Bermotor Bekas â€” 10% Ã— 11/12 Ã— 12% = efektif 1,1%</option>
              <option value="ayda">Agunan yang Diambil Alih (AYDA) â€” 10% Ã— 11/12 Ã— 12% = efektif 1,1%</option>
            </optgroup>
            <optgroup label="â”€â”€ Lainnya â”€â”€">
              <option value="kms">Kegiatan Membangun Sendiri (KMS) â€” 20% Ã— 11/12 Ã— 12% = efektif 2,2%</option>
              <option value="pemakaian_sendiri">Pemakaian Sendiri / Pemberian Cuma-Cuma â€” 12% Ã— 11/12 Ã— HPP = efektif 11% dari HPP</option>
            </optgroup>
          </select>
        </div>

        <div class="field">
          <label id="ppn_input_label">Harga / Nilai Transaksi Sudah Termasuk PPN (Rp)</label>
          <input type="number" id="ppn_dpp" placeholder="0" oninput="hitungPPN()">
        </div>
      </div>

      <!-- Info box dinamis -->
      <div class="grossup-info" id="ppn_info_box" style="margin-top:0.75rem; display:block; border-color:rgba(124,58,237,0.3); background:rgba(124,58,237,0.06); color:#c4b5fd;">
        â„¹ï¸ <b>PMK 131/2024 Pasal 3:</b> BKP/JKP Non-Mewah â†’ DPP Nilai Lain = <b>11/12 Ã— Harga</b> â†’ PPN = 12% Ã— 11/12 Ã— Harga = <b>11% Ã— Harga</b>. Tarif UU tetap 12%, tarif efektif 11%.
      </div>
    </div>

    <div class="result-box" id="resultPPN" style="display:none">
      <div class="result-title">ğŸ“Š Hasil Perhitungan PPN</div>
      <table class="result-table" id="tablePPN"></table>
    </div>
  </div>

  <!-- PPnBM -->
  <div id="ppnbm" class="panel">
    <div class="section-header">
      <h2>PPnBM â€” Pajak Penjualan atas Barang Mewah</h2>
      <p>Pajak atas penyerahan Barang Kena Pajak yang tergolong mewah.</p>
    </div>

    <div class="card">
      <div class="card-title">Detail Transaksi</div>
      <div class="grid-2">
        <div class="field">
          <label>Jenis Barang Mewah</label>
          <select id="ppnbm_jenis" onchange="hitungPPnBM()">
            <optgroup label="â”€â”€ Kendaraan Bermotor (PP 73/2019 jo PP 74/2021) â”€â”€">
              <option value="3">LCGC / Kendaraan Hemat Energi &amp; Emisi Rendah (3%)</option>
              <option value="6">Sedan / Wagon / Hatchback â‰¤ 1.500cc Bensin (6%)</option>
              <option value="10">Sedan / Wagon â‰¤ 1.500cc 4WD Bensin (10%)</option>
              <option value="15">MPV / Pick-Up / SUV â‰¤ 1.500cc Bensin (15%)</option>
              <option value="20">Kendaraan 1.500â€“2.500cc Bensin (20%)</option>
              <option value="25">Kendaraan 1.500â€“2.500cc 4WD Bensin (25%)</option>
              <option value="40">Kendaraan 2.500â€“3.000cc Bensin (40%)</option>
              <option value="50">Kendaraan &gt; 3.000cc Bensin (50%)</option>
              <option value="60">Kendaraan CBU Impor â€” Kategori Tertentu (60%)</option>
              <option value="70">Kendaraan CBU Impor Mewah &gt; 3.000cc 4WD (70%)</option>
            </optgroup>
            <optgroup label="â”€â”€ Non-Kendaraan â”€â”€">
              <option value="20">Hunian / Properti Mewah â‰¥ Rp 20 Miliar (20%)</option>
              <option value="50">Kapal Pesiar / Yacht / Hovercraft (50%)</option>
              <option value="75">Pesawat Terbang Pribadi / Helikopter (75%)</option>
              <option value="75">Senjata Api (kecuali keperluan negara) (75%)</option>
              <option value="95">Rumah &amp; Tanah Sangat Mewah â‰¥ Rp 30 Miliar (95%)</option>
            </optgroup>
          </select>
        </div>
        <div class="field">
          <label>Harga Jual / DPP (Rp)</label>
          <input type="number" id="ppnbm_dpp" placeholder="0" oninput="hitungPPnBM()">
        </div>
      </div>
      <div class="tarif-info" id="ppnbm_tarif_info">Tarif PPnBM: 3%</div>
      <div class="grossup-info" style="border-color:rgba(250,204,21,0.3);background:rgba(250,204,21,0.06);color:#fde68a;">
        â„¹ï¸ <b>PP 73/2019 jo PP 74/2021:</b> Tarif kendaraan bermotor ditentukan oleh kapasitas mesin, jenis bahan bakar, dan tipe kendaraan. Konsultasikan dengan tabel resmi untuk kepastian tarif spesifik kendaraan Anda.
      </div>
    </div>

    <div class="result-box" id="resultPPnBM" style="display:none">
      <div class="result-title">ğŸ“Š Hasil Perhitungan PPnBM</div>
      <table class="result-table" id="tablePPnBM"></table>
    </div>
  </div>

  <!-- PPH 24 -->
  <div id="pph24" class="panel">
    <div class="section-header">
      <h2>Kredit Pajak PPh Pasal 24</h2>
      <p>Pajak yang dibayar/terutang di luar negeri yang dapat dikreditkan terhadap PPh terutang di Indonesia.</p>
    </div>

    <div class="card">
      <div class="card-title">Penghasilan & Pajak Dalam Negeri</div>
      <div class="grid-2">
        <div class="field">
          <label>Total Penghasilan Neto (DN + LN) Setahun (Rp)</label>
          <input type="number" id="p24_total_neto" placeholder="Contoh: 500000000" oninput="hitungP24()">
        </div>
        <div class="field">
          <label>PTKP</label>
          <select id="p24_ptkp" onchange="hitungP24()">
            <option value="54000000">TK/0 â€” Rp 54.000.000</option>
            <option value="58500000">TK/1 â€” Rp 58.500.000</option>
            <option value="63000000">TK/2 â€” Rp 63.000.000</option>
            <option value="67500000">TK/3 â€” Rp 67.500.000</option>
            <option value="58500000">K/0 â€” Rp 58.500.000</option>
            <option value="63000000">K/1 â€” Rp 63.000.000</option>
            <option value="67500000">K/2 â€” Rp 67.500.000</option>
            <option value="72000000">K/3 â€” Rp 72.000.000</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card" id="p24_negara_card">
      <div class="card-title">Sumber Penghasilan Luar Negeri</div>
      <div id="p24_negara_list"></div>
      <button class="btn" style="margin-top:1rem; padding:9px 18px; font-size:0.82rem;" onclick="tambahNegara()">+ Tambah Negara</button>
    </div>

    <div class="ter-note" style="margin-bottom:1.5rem;">
      âš ï¸ <strong>Batas Kredit Pajak PPh 24:</strong> Kredit yang diakui = nilai terkecil antara <em>pajak yang dibayar/terutang di LN</em> dengan <em>batas kredit maksimum</em> (proporsional PPh Indonesia atas penghasilan LN tersebut).
    </div>

    <div class="result-box" id="resultP24" style="display:none; border-color:rgba(245,158,11,0.3); background:linear-gradient(135deg,rgba(245,158,11,0.06),rgba(251,191,36,0.03))">
      <div class="result-title" style="color:#fbbf24">ğŸŒ Hasil Perhitungan Kredit Pajak PPh 24</div>
      <table class="result-table" id="tableP24"></table>
      <div id="p24_detail_negara" style="margin-top:1.25rem;"></div>
    </div>
  </div>

  <!-- PPH 26 -->
  <div id="pph26" class="panel">
    <div class="section-header">
      <h2>PPh Pasal 26</h2>
      <p>Pajak atas penghasilan yang diterima/diperoleh Wajib Pajak Luar Negeri (WPLN) selain BUT dari Indonesia.</p>
    </div>

    <div class="card">
      <div class="card-title">Tarif Umum PPh 26 (Tanpa P3B)</div>
      <table class="tarif-table">
        <tr><th>Jenis Penghasilan</th><th>Tarif</th></tr>
        <tr><td>Dividen</td><td>20%</td></tr>
        <tr><td>Bunga, Royalti, Hadiah, Pensiun</td><td>20%</td></tr>
        <tr><td>Sewa &amp; Penghasilan atas Harta</td><td>20%</td></tr>
        <tr><td>Imbalan Jasa, Pekerjaan, Kegiatan</td><td>20%</td></tr>
        <tr><td>Keuntungan Penjualan Harta</td><td>20%</td></tr>
        <tr><td>Premi Asuransi / Reasuransi</td><td>20%</td></tr>
      </table>
      <div class="ter-note" style="margin-top:1rem;">
        â„¹ï¸ Tarif 20% dapat dikurangi berdasarkan <strong>Perjanjian Penghindaran Pajak Berganda (P3B / Tax Treaty)</strong>. Gunakan lookup di bawah untuk menemukan tarif P3B yang berlaku.
      </div>
    </div>

    <!-- P3B LOOKUP DATABASE -->
    <div class="card">
      <div class="card-title">ğŸ” Lookup Tarif P3B / Tax Treaty</div>
      <div class="grid-2">
        <div class="field">
          <label>Negara Domisili WPLN</label>
          <div id="p3b_negara_wrap" style="position:relative;">
            <input type="text" id="p3b_negara_input" placeholder="ğŸ” Ketik nama negara..." autocomplete="off"
              oninput="filterNegaraP3B()" onfocus="showNegaraDropdown()" onblur="setTimeout(hideNegaraDropdown,180)"
              style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:10px 14px;color:var(--text);font-family:inherit;font-size:0.9rem;outline:none;box-sizing:border-box;">
            <div id="p3b_negara_list" style="display:none;position:absolute;top:calc(100% + 4px);left:0;right:0;background:var(--surface2);border:1px solid var(--border);border-radius:10px;max-height:220px;overflow-y:auto;z-index:200;box-shadow:0 8px 24px rgba(0,0,0,0.4);"></div>
            <input type="hidden" id="p3b_negara" value="">
          </div>
        </div>
        <div class="field">
          <label>Jenis Penghasilan</label>
          <select id="p3b_jenis" onchange="lookupP3B()">
            <option value="dividen">Dividen</option>
            <option value="bunga">Bunga (Interest)</option>
            <option value="royalti">Royalti</option>
            <option value="jasa">Imbalan Jasa / Technical Services</option>
            <option value="kapgain">Capital Gain / Keuntungan Penjualan Harta</option>
          </select>
        </div>
      </div>
      <div id="p3b_result" style="display:none; margin-top:1rem;">
        <div id="p3b_info" style="background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:14px 18px;font-size:0.92rem;line-height:1.7;"></div>
        <button onclick="p3bPakaiTarif()" style="margin-top:10px;padding:8px 20px;background:var(--accent);color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:0.9rem;font-weight:600;">âœ“ Pakai Tarif Ini untuk Hitung PPh 26</button>
      </div>
      <div id="p3b_notfound" style="display:none;margin-top:1rem;color:#f87171;font-size:0.9rem;">
        âš ï¸ Negara ini belum/tidak memiliki P3B dengan Indonesia â€” gunakan tarif umum 20%.
      </div>
    </div>

    <div class="card">
      <div class="card-title">Detail Transaksi</div>
      <div class="grid-2">
        <div class="field">
          <label>Jenis Penghasilan</label>
          <select id="p26_jenis" onchange="hitungP26()">
            <option value="20_dividen">Dividen (20%)</option>
            <option value="20_bunga">Bunga / Royalti / Hadiah (20%)</option>
            <option value="20_sewa">Sewa &amp; Penghasilan atas Harta (20%)</option>
            <option value="20_jasa">Imbalan Jasa / Pekerjaan / Kegiatan (20%)</option>
            <option value="20_premi">Premi Asuransi / Reasuransi (20%)</option>
            <option value="20_saham">Keuntungan Penjualan Saham BUT (20%)</option>
            <option value="custom">P3B / Tax Treaty â€” Tarif Khusus</option>
          </select>
        </div>
        <div class="field" id="p26_custom_wrap" style="display:none">
          <label>Tarif P3B / Tax Treaty (%)</label>
          <input type="number" id="p26_custom_tarif" placeholder="Contoh: 10" min="0" max="20" step="0.5" oninput="hitungP26()">
        </div>
        <div class="field">
          <label class="label-with-info">
            Skema Penghitungan
            <i class="info-icon" id="p26_gu_icon" style="display:none">i
              <div class="tooltip-box">
                <strong>ğŸ’¡ Gross Up PPh 26</strong>
                Imbalan dinaikkan agar WPLN tetap menerima nilai bersih yang disepakati setelah PPh 26 dipotong.
                <div class="formula">Bruto = Neto Ã· (1 âˆ’ Tarif)</div>
              </div>
            </i>
          </label>
          <select id="p26_skema" onchange="hitungP26()">
            <option value="gross">Gross â€” WPLN Tanggung Pajak</option>
            <option value="netto">Netto â€” Pemberi Tanggung Pajak</option>
            <option value="gross_up">Gross Up â€” Imbalan Dinaikkan</option>
          </select>
        </div>
        <div class="field">
          <label id="p26_input_label">Penghasilan Bruto (Rp)</label>
          <input type="number" id="p26_bruto" placeholder="0" oninput="hitungP26()">
        </div>
      </div>
      <div class="tarif-info" id="p26_tarif_info">Tarif: 20%</div>
      <div id="p26_treaty_badge" style="display:none;margin-top:8px;padding:6px 12px;background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:8px;font-size:0.85rem;color:#6ee7b7;"></div>
      <div class="grossup-info" id="p26_gu_box" style="display:none">
        â„¹ï¸ <b>Gross Up:</b> Input nilai neto yang ingin diterima WPLN. Bruto dihitung otomatis = Neto Ã· (1 âˆ’ Tarif).
      </div>
      <div class="grossup-info" id="p26_netto_box" style="display:none; border-color:rgba(16,185,129,0.3); background:rgba(16,185,129,0.06); color:#6ee7b7;">
        â„¹ï¸ <b>Netto:</b> WPLN terima penuh nilai bruto. PPh 26 ditanggung pemberi penghasilan.
      </div>
    </div>

    <div class="result-box" id="resultP26" style="display:none">
      <div class="result-title">ğŸ“Š Hasil Perhitungan PPh 26</div>
      <table class="result-table" id="tableP26"></table>
    </div>
  </div>

</div>

<script>
// â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fmt(n) {
  if (isNaN(n) || n === null) return 'Rp 0';
  return 'Rp ' + Math.round(n).toLocaleString('id-ID');
}

function fmtPct(n) {
  return n.toFixed(2).replace('.', ',') + '%';
}

// Label untuk semua pasal di dropdown
const NAV_LABELS = {
  pph21:    'âš¡ PPh 21',
  pph23:    'ğŸ’¸ PPh 23',
  pph4:     'ğŸ  PPh 4(2)',
  pph15:    'ğŸš¢ PPh 15',
  pphbadan: 'ğŸ¢ PPh Badan',
  ppn:      'ğŸ§¾ PPN',
  ppnbm:    'ğŸš— PPnBM',
  pph24:    'ğŸŒ PPh 24',
  pph26:    'âœˆï¸ PPh 26',
};

function switchTab(id, el) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-dd-item').forEach(i => i.classList.remove('active'));
  if (el) el.classList.add('active');
  document.getElementById('navDropdownLabel').textContent = NAV_LABELS[id] || id;
  const wrap = document.getElementById('navDropdownWrap');
  const btn  = document.getElementById('navDropdownBtn');
  wrap.classList.remove('open');
  btn.classList.remove('open');
}

function toggleNavDropdown() {
  const wrap = document.getElementById('navDropdownWrap');
  const btn  = document.getElementById('navDropdownBtn');
  wrap.classList.toggle('open');
  btn.classList.toggle('open');
}

document.addEventListener('click', function(e) {
  const wrap = document.getElementById('navDropdownWrap');
  if (wrap && !wrap.contains(e.target)) {
    wrap.classList.remove('open');
    document.getElementById('navDropdownBtn').classList.remove('open');
  }
});

function renderTable(tableId, rows) {
  const el = document.getElementById(tableId);
  el.innerHTML = rows.map(r => {
    const cls = r.total ? ' class="total"' : r.warn ? ' style="color:#f59e0b"' : '';
    return `<tr${cls}><td>${r.label}</td><td>${r.value}</td></tr>`;
  }).join('');
}

// â”€â”€ PPH 21 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentMode = 'ter';

function setMode(mode) {
  currentMode = mode;
  const modes = ['ter', 'umum', 'nontetap', 'bp'];
  modes.forEach(m => {
    const item = document.getElementById('acc_' + m);
    const body = document.getElementById('body_' + m);
    if (!item || !body) return;
    if (m === mode) {
      // Toggle: klik item yg sudah open â†’ tutup; klik item tertutup â†’ buka
      const isOpen = item.classList.contains('open');
      item.classList.toggle('open', !isOpen);
      body.style.display = isOpen ? 'none' : 'block';
      currentMode = isOpen ? null : mode;
    } else {
      item.classList.remove('open');
      body.style.display = 'none';
    }
  });
  if (mode === 'nontetap') hitungNonTetap();
  if (mode === 'bp') hitungBP();
}

function getPTKP21() {
  const v = document.getElementById('pph21_ptkp').value;
  return parseInt(v.replace('_k',''));
}

// Tarif PPh 21 progresif berdasarkan PKP setahun
function tarifPPh21(pkp) {
  if (pkp <= 0) return 0;
  let pajak = 0;
  // Tarif Pasal 17 UU HPP (berlaku sejak 2022):
  // 5%  â†’ s.d. Rp 60 juta
  // 15% â†’ Rp 60 juta â€“ Rp 250 juta  (lebar 190 juta)
  // 25% â†’ Rp 250 juta â€“ Rp 500 juta (lebar 250 juta)
  // 30% â†’ Rp 500 juta â€“ Rp 5 miliar (lebar 4.500 juta)
  // 35% â†’ di atas Rp 5 miliar
  const brackets = [
    [60000000,   0.05],
    [190000000,  0.15],
    [250000000,  0.25],   // â† lebar 250jt (250Mâ€“500M), bukan 130jt
    [4500000000, 0.30],
  ];
  let remaining = pkp;
  for (const [limit, rate] of brackets) {
    if (remaining <= 0) break;
    const taxable = Math.min(remaining, limit);
    pajak += taxable * rate;
    remaining -= taxable;
  }
  if (remaining > 0) pajak += remaining * 0.35;
  return pajak;
}

function toggleSkenario() {
  const sk = document.getElementById('pph21_skenario').value;
  document.getElementById('field_bulan_mulai').style.display = sk === 'B' ? 'block' : 'none';
}

function toggleGrossUpInfo21() {
  const skema = document.getElementById('pph21_skema').value;
  document.getElementById('grossup_info_box').style.display    = skema === 'gross_up' ? 'block' : 'none';
  document.getElementById('grossup_netto_box').style.display   = skema === 'netto'    ? 'block' : 'none';
  document.getElementById('grossup_info_icon').style.display   = skema === 'gross_up' ? 'inline-flex' : 'none';
}

// â”€â”€ HELPER PTKP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getPTKP21() {
  const v = document.getElementById('pph21_ptkp').value;
  return parseInt(v.replace('_k',''));
}

function setInputMode21(mode) {
  document.getElementById('imt_bulan').classList.toggle('active', mode === 'bulan');
  document.getElementById('imt_setahun').classList.toggle('active', mode === 'setahun');
  const perBulan = mode === 'bulan';
  document.getElementById('lbl21_gaji').textContent  = perBulan ? 'Gaji Pokok per Bulan (Rp)'                      : 'Gaji Pokok â€” Total Setahun (Rp)';
  document.getElementById('lbl21_tunj').textContent  = perBulan ? 'Tunjangan Lainnya per Bulan (Rp)'               : 'Tunjangan Lainnya â€” Total Setahun (Rp)';
  document.getElementById('lbl21_premi').textContent = perBulan ? 'Premi Asuransi Dibayar Perusahaan per Bulan (Rp)': 'Premi Asuransi â€” Total Setahun (Rp)';
  document.getElementById('lbl21_iuran').textContent = perBulan ? 'Iuran Pensiun / JHT per Bulan (Rp)'             : 'Iuran Pensiun / JHT â€” Total Setahun (Rp)';
  hitung21();
}

function hitung21() {
  const gaji    = parseFloat(document.getElementById('pph21_gaji').value)         || 0;
  const tunj    = parseFloat(document.getElementById('pph21_tunjangan').value)    || 0;
  const premi   = parseFloat(document.getElementById('pph21_premi').value)        || 0;
  const bonus   = parseFloat(document.getElementById('pph21_bonus').value)        || 0;
  const iuran   = parseFloat(document.getElementById('pph21_iuran').value)        || 0;
  const pphDP   = parseFloat(document.getElementById('pph21_pph_dipotong').value) || 0;
  const ptkp    = getPTKP21();
  const skema   = document.getElementById('pph21_skema').value;
  const skenario = document.getElementById('pph21_skenario').value;
  const bulanTerakhir = parseInt(document.getElementById('pph21_bulan_terakhir').value);
  const bulanMulai    = skenario === 'B'
    ? parseInt(document.getElementById('pph21_bulan_mulai').value)
    : 1;

  // Mode input: 'bulan' = nilai per bulan (Ã—N), 'setahun' = nilai sudah total aktual
  const inputMode = document.getElementById('imt_setahun').classList.contains('active') ? 'setahun' : 'bulan';

  const ptkpLabel = document.getElementById('pph21_ptkp').options[document.getElementById('pph21_ptkp').selectedIndex].text.split('â€”')[0].trim();
  const bulanNames = ['','Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'];

  // Guard
  if (bulanMulai > bulanTerakhir) {
    document.getElementById('result21').style.display = 'none'; return;
  }
  if (gaji === 0 && tunj === 0 && bonus === 0) {
    document.getElementById('result21').style.display = 'none'; return;
  }

  const N = bulanTerakhir - bulanMulai + 1; // jumlah bulan kerja

  // Konversi ke nilai "per bulan efektif" untuk perhitungan internal
  // Mode setahun: user input total aktual, dibagi N untuk dapat per-bulan ekuivalen
  const gajiPB   = inputMode === 'setahun' ? gaji  / N : gaji;
  const tunjPB   = inputMode === 'setahun' ? tunj  / N : tunj;
  const premiPB  = inputMode === 'setahun' ? premi / N : premi;
  const iuranPB  = inputMode === 'setahun' ? iuran / N : iuran;
  // bonus selalu total, tidak berubah

  // â”€â”€ Fungsi bantu hitung PPh terutang berdasarkan skenario â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function hitungPPHTerutang(gajiEff, tunjEff, premiEff, iuranEff, bonusEff) {
    // gajiEff/tunjEff/premiEff = nilai per bulan (sudah termasuk tunjangan PPh jika gross-up)
    const brutoAktual = (gajiEff + tunjEff + premiEff) * N + bonusEff;
    let pphTerutang;

    if (skenario === 'A') {
      // Bruto aktual, tidak disetahunkan
      // BJ: 5% Ã— bruto, maks Rp500.000/bulan proporsional
      const bj = Math.min(brutoAktual * 0.05, N * 500000);
      const iurAktual = iuranEff * N;
      const neto = brutoAktual - bj - iurAktual;
      const pkp  = Math.max(neto - ptkp, 0);
      pphTerutang = tarifPPh21(pkp);
    } else {
      // Skenario B: setahunkan lalu proporsionalkan
      const brutoSetahun = brutoAktual * (12 / N);
      const bj = Math.min(brutoSetahun * 0.05, 6000000);
      const iurSetahun = iuranEff * 12;
      const neto = brutoSetahun - bj - iurSetahun;
      const pkp  = Math.max(neto - ptkp, 0);
      pphTerutang = tarifPPh21(pkp) * (N / 12);
    }
    return pphTerutang;
  }

  // â”€â”€ GROSS: karyawan tanggung PPh masa terakhir â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (skema === 'gross') {
    const brutoAktual = (gajiPB + tunjPB + premiPB) * N + bonus;
    let bj, iurAktual, neto, pkp;
    if (skenario === 'A') {
      bj = Math.min(brutoAktual * 0.05, N * 500000);
      iurAktual = iuranPB * N;
      neto = brutoAktual - bj - iurAktual;
      pkp  = Math.max(neto - ptkp, 0);
    } else {
      const brutoSetahun = brutoAktual * (12 / N);
      bj = Math.min(brutoSetahun * 0.05, 6000000);
      const iurSetahun = iuranPB * 12;
      neto = brutoSetahun - bj - iurSetahun;
      pkp  = Math.max(neto - ptkp, 0);
    }
    const pphTerutang = skenario === 'A'
      ? tarifPPh21(pkp)
      : tarifPPh21(pkp) * (N / 12);
    const pphMasaTerakhir = Math.round(pphTerutang - pphDP);
    const gajiBulanIni = gajiPB + tunjPB + premiPB;
    const thp = gajiBulanIni - pphMasaTerakhir;
    const modeLabel = inputMode === 'setahun' ? ' (dari total setahun)' : '';

    renderTable('table21', [
      { label: `Skenario`, value: skenario === 'A' ? 'A â€” Dari Januari / Resign tengah tahun' : `B â€” Mulai bekerja ${bulanNames[bulanMulai]}` },
      { label: 'Masa Pajak Terakhir', value: bulanNames[bulanTerakhir] },
      { label: `Jumlah Bulan Kerja (${bulanNames[bulanMulai]}â€“${bulanNames[bulanTerakhir]})`, value: N + ' bulan' },
      { label: 'Penghasilan Bruto Aktual (total)' + modeLabel, value: fmt(brutoAktual) },
      { label: 'Biaya Jabatan', value: fmt(skenario === 'A' ? Math.min(brutoAktual * 0.05, N * 500000) : Math.min(brutoAktual * (12/N) * 0.05, 6000000)) },
      { label: 'Iuran Pensiun / JHT', value: fmt(skenario === 'A' ? iuranPB * N : iuranPB * 12) },
      ...(skenario === 'B' ? [
        { label: 'Penghasilan Bruto Disetahunkan', value: fmt(brutoAktual * 12 / N) },
      ] : []),
      { label: `PTKP (${ptkpLabel})`, value: fmt(ptkp) },
      { label: skenario === 'B' ? 'PKP (disetahunkan)' : 'PKP', value: fmt(pkp) },
      { label: 'PPh 21 Terutang (total)', value: fmt(pphTerutang) },
      { label: 'PPh 21 Sudah Dipotong (TER sebelumnya)', value: fmt(pphDP) },
      { label: 'PPh 21 Masa Pajak Terakhir', value: fmt(pphMasaTerakhir), total: true },
      { label: 'Gaji Bulan Terakhir', value: fmt(gajiBulanIni) },
      { label: 'Take Home Pay Bulan Terakhir (Gaji âˆ’ PPh MT)', value: fmt(thp), ...(thp < 0 ? {warn: true} : {}) },
      ...(thp < 0 ? [{ label: 'âš ï¸ THP negatif karena PPh dipotong sekaligus di masa terakhir. Isi "PPh 21 Sudah Dipotong Sebelumnya" sesuai potongan TER bulan-bulan sebelumnya.', value: '', warn: true }] : []),
    ]);

  // â”€â”€ NETTO: perusahaan tanggung PPh masa terakhir â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  } else if (skema === 'netto') {
    const brutoAktual = (gajiPB + tunjPB + premiPB) * N + bonus;
    const pphTerutang = hitungPPHTerutang(gajiPB, tunjPB, premiPB, iuranPB, bonus);
    const pphMasaTerakhir = Math.round(pphTerutang - pphDP);

    renderTable('table21', [
      { label: 'Skenario', value: skenario === 'A' ? 'A â€” Dari Januari / Resign tengah tahun' : `B â€” Mulai bekerja ${bulanNames[bulanMulai]}` },
      { label: 'Masa Pajak Terakhir', value: bulanNames[bulanTerakhir] },
      { label: 'Jumlah Bulan Kerja', value: N + ' bulan' },
      { label: 'Penghasilan Bruto Aktual (total)', value: fmt(brutoAktual) },
      { label: 'PPh 21 Terutang (total)', value: fmt(pphTerutang) },
      { label: 'PPh 21 Sudah Dipotong (TER sebelumnya)', value: fmt(pphDP) },
      { label: 'PPh 21 Masa Pajak Terakhir', value: fmt(pphMasaTerakhir), total: true },
      { label: 'PPh Ditanggung Perusahaan (biaya tambahan)', value: fmt(pphMasaTerakhir) },
      { label: 'Take Home Pay Karyawan (Gaji penuh diterima)', value: fmt(gajiPB + tunjPB + premiPB) },
      { label: 'Total Biaya Perusahaan Bulan Ini', value: fmt(gajiPB + tunjPB + premiPB + pphMasaTerakhir) },
    ]);

  // â”€â”€ GROSS UP: cari tunjangan PPh masa terakhir â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  } else if (skema === 'gross_up') {
    // Iterasi: cari T (tunjangan PPh) sehingga PPh_terutang(bruto + T) - pphDP = T
    let T = 0;
    for (let i = 0; i < 300; i++) {
      const pphTerutangBaru = hitungPPHTerutang(gajiPB, tunjPB + T/N, premiPB, iuranPB, bonus);
      const newT = Math.max(pphTerutangBaru - pphDP, 0);
      if (Math.abs(newT - T) < 1) { T = newT; break; }
      T = newT;
    }
    const tunjanganPPh = Math.round(T);
    const pphTerutangFinal = hitungPPHTerutang(gajiPB, tunjPB + tunjanganPPh/N, premiPB, iuranPB, bonus);
    const pphMasaTerakhir = Math.round(pphTerutangFinal - pphDP);
    const brutoAktualBaru = (gajiPB + tunjPB + premiPB) * N + bonus + tunjanganPPh;

    renderTable('table21', [
      { label: 'Skenario', value: skenario === 'A' ? 'A â€” Dari Januari / Resign tengah tahun' : `B â€” Mulai bekerja ${bulanNames[bulanMulai]}` },
      { label: 'Masa Pajak Terakhir', value: bulanNames[bulanTerakhir] },
      { label: 'Jumlah Bulan Kerja', value: N + ' bulan' },
      { label: 'Gaji + Tunjangan Asli per Bulan', value: fmt(gajiPB + tunjPB + premiPB) },
      { label: 'âœ¦ Tunjangan PPh Gross Up (ditambahkan di masa terakhir)', value: fmt(tunjanganPPh) },
      { label: 'Penghasilan Bruto Baru Aktual (total)', value: fmt(brutoAktualBaru) },
      { label: 'PPh 21 Terutang (dengan tunjangan PPh)', value: fmt(pphTerutangFinal) },
      { label: 'PPh 21 Sudah Dipotong (TER sebelumnya)', value: fmt(pphDP) },
      { label: 'PPh 21 Masa Pajak Terakhir (= Tunjangan PPh)', value: fmt(pphMasaTerakhir), total: true },
      { label: 'Take Home Pay Karyawan (terima gaji asli)', value: fmt(gajiPB + tunjPB + premiPB) },
      { label: 'Total Biaya Perusahaan Bulan Ini', value: fmt(gajiPB + tunjPB + premiPB + tunjanganPPh) },
    ]);
  }

  document.getElementById('result21').style.display = 'block';
}

// â”€â”€ TER DATA (PMK 168/2023) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Format: [batas_atas_inklusif, tarif_persen]
// batas_atas = null â†’ tak terbatas
const TER_A = [
  [5400000, 0], [5650000, 0.25], [5950000, 0.5], [6300000, 0.75],
  [6750000, 1], [7500000, 1.25], [8550000, 1.5], [9650000, 1.75],
  [10050000, 2], [10350000, 2.25], [10700000, 2.5], [11050000, 3],
  [11600000, 3.5], [12500000, 4], [13750000, 5], [15100000, 6],
  [16950000, 7], [19750000, 8], [24150000, 9], [26450000, 10],
  [28000000, 11], [30050000, 12], [32400000, 13], [35400000, 14],
  [39100000, 15], [43850000, 16], [47800000, 17], [51400000, 18],
  [56300000, 19], [62500000, 20], [69000000, 21], [79000000, 22],
  [85000000, 23], [95000000, 24], [110000000, 25], [134000000, 26],
  [141000000, 27], [155000000, 28], [162000000, 29], [259000000, 30],
  [280000000, 31], [319000000, 32], [356000000, 33], [null, 34],
];

const TER_B = [
  [6200000, 0], [6500000, 0.25], [6850000, 0.5], [7300000, 0.75],
  [9200000, 1], [10750000, 1.25], [11250000, 1.5], [11600000, 1.75],
  [12600000, 2], [13600000, 3], [14950000, 4], [16400000, 5],
  [18450000, 6], [21850000, 7], [26000000, 8], [27700000, 9],
  [29350000, 10], [31450000, 11], [33950000, 12], [37100000, 13],
  [41100000, 14], [45800000, 15], [49500000, 16], [53800000, 17],
  [58500000, 18], [64000000, 19], [71000000, 20], [80000000, 21],
  [85000000, 22], [95000000, 23], [110000000, 24], [130000000, 25],
  [150000000, 26], [168000000, 27], [180000000, 28], [190000000, 29],
  [210000000, 30], [379000000, 31], [null, 34],
];

const TER_C = [
  [6600000, 0], [6950000, 0.25], [7350000, 0.5], [7800000, 0.75],
  [8850000, 1], [9800000, 1.25], [10950000, 1.5], [11200000, 1.75],
  [12050000, 2], [12950000, 3], [14150000, 4], [15550000, 5],
  [17050000, 6], [19500000, 7], [22700000, 8], [29500000, 9],
  [30050000, 10], [31992500, 11], [33475000, 12], [35400000, 13],
  [39100000, 14], [43850000, 15], [47800000, 16], [51400000, 17],
  [56300000, 18], [62500000, 19], [69000000, 20], [79000000, 21],
  [85000000, 22], [95000000, 23], [110000000, 24], [134000000, 25],
  [141000000, 26], [155000000, 27], [162000000, 28], [259000000, 29],
  [280000000, 30], [319000000, 31], [356000000, 32], [null, 34],
];

const TER_LABEL = {
  A: { nama:'A', desc:'TK/0 â€” Tidak Kawin, Tanpa Tanggungan', data: TER_A },
  B: { nama:'B', desc:'TK/1, TK/2, TK/3, K/0', data: TER_B },
  C: { nama:'C', desc:'K/1, K/2, K/3', data: TER_C },
};

function getTERKategori() {
  const v = document.getElementById('ter_ptkp').value;
  if (v.startsWith('A')) return 'A';
  if (v.startsWith('B')) return 'B';
  return 'C';
}

function getTERRate(bruto, kat) {
  const table = TER_LABEL[kat].data;
  for (const [batas, rate] of table) {
    if (batas === null || bruto <= batas) return rate;
  }
  return 34;
}

function fmtBatas(val) {
  if (val === null) return '> batas sebelumnya';
  return 'Rp ' + val.toLocaleString('id-ID');
}

function buildTERRefTable(kat, bruto) {
  const table = TER_LABEL[kat].data;
  let prev = 0;
  let rows = `<tr><th>Penghasilan Bruto</th><th style="text-align:right">Tarif TER</th></tr>`;
  for (let i = 0; i < table.length; i++) {
    const [batas, rate] = table[i];
    let range = '';
    if (i === 0) {
      range = `â‰¤ ${fmtBatas(batas)}`;
    } else if (batas === null) {
      range = `> ${fmtBatas(table[i-1][0])}`;
    } else {
      range = `${fmtBatas(table[i-1][0]+1)} â€” ${fmtBatas(batas)}`;
    }
    const isActive = bruto > 0 && (bruto <= (batas||Infinity)) && (i === 0 || bruto > table[i-1][0]);
    const cls = isActive ? ' class="ter-active-row"' : '';
    rows += `<tr${cls}><td>${range}</td><td>${rate}%</td></tr>`;
    prev = batas || 0;
  }
  return rows;
}

let terTableOpen = false;
function toggleTerTable() {
  terTableOpen = !terTableOpen;
  document.getElementById('ter_table_wrap').classList.toggle('open', terTableOpen);
  document.getElementById('ter_toggle_icon').textContent = terTableOpen ? 'â–¼' : 'â–¶';
}

function hitungTER() {
  const gaji     = parseFloat(document.getElementById('ter_gaji').value) || 0;
  const tunj     = parseFloat(document.getElementById('ter_tunjangan').value) || 0;
  const bonus    = parseFloat(document.getElementById('ter_bonus').value) || 0;
  const premi    = parseFloat(document.getElementById('ter_premi').value) || 0;
  const kat      = getTERKategori();
  const katInfo  = TER_LABEL[kat];
  const skema    = document.getElementById('ter_skema').value;

  // Info boxes skema
  document.getElementById('ter_gu_box').style.display    = skema === 'gross_up' ? 'block' : 'none';
  document.getElementById('ter_netto_box').style.display = skema === 'netto'    ? 'block' : 'none';
  document.getElementById('ter_gu_icon').style.display   = skema === 'gross_up' ? 'inline-flex' : 'none';

  const brutoAsli = gaji + tunj + bonus + premi;

  // Update kategori display (pakai bruto asli untuk preview)
  document.getElementById('ter_kat_box').style.display    = 'flex';
  document.getElementById('ter_toggle_btn').style.display = 'flex';
  document.getElementById('ter_kat_huruf').textContent    = kat;
  document.getElementById('ter_kat_nama').textContent     = kat;
  document.getElementById('ter_kat_desc').textContent     = katInfo.desc;

  const ratePreview = getTERRate(brutoAsli, kat);
  document.getElementById('ter_rate_display').textContent = ratePreview + '%';
  document.getElementById('ter_ref_table').innerHTML = buildTERRefTable(kat, brutoAsli);

  if (brutoAsli === 0) { document.getElementById('resultTER').style.display = 'none'; return; }

  const masaLabel = document.getElementById('ter_masa').options[document.getElementById('ter_masa').selectedIndex].text;

  let rows = [];

  if (skema === 'gross_up') {
    // Iterasi: cari tunjangan PPh T sehingga TER Ã— (Bruto + T) = T
    // Perlu iterasi karena TER bracket bisa berubah saat bruto naik
    let T = 0;
    for (let i = 0; i < 300; i++) {
      const brutoBaru  = brutoAsli + T;
      const rateBaru   = getTERRate(brutoBaru, kat);
      const pphBaru    = Math.round(brutoBaru * (rateBaru / 100));
      if (Math.abs(pphBaru - T) < 1) { T = pphBaru; break; }
      T = pphBaru;
    }
    const tunjanganPPh  = T;
    const brutoBaru     = brutoAsli + tunjanganPPh;
    const rateFinal     = getTERRate(brutoBaru, kat);
    const pphFinal      = Math.round(brutoBaru * (rateFinal / 100));

    rows = [
      { label: 'Masa Pajak', value: masaLabel },
      { label: 'Kategori TER', value: `Kategori ${kat} â€” ${katInfo.desc}` },
      { label: 'Penghasilan Bruto Asli (Gaji + Tunjangan)', value: fmt(brutoAsli) },
      { label: 'âœ¦ Tunjangan PPh Gross Up (ditambahkan)', value: fmt(tunjanganPPh) },
      { label: 'Penghasilan Bruto Baru (termasuk tunjangan PPh)', value: fmt(brutoBaru) },
      { label: `Tarif TER Kategori ${kat} (atas bruto baru)`, value: rateFinal + '%' },
      { label: 'PPh 21 Dipotong (= Tunjangan PPh)', value: fmt(pphFinal), total: true },
      { label: 'Take Home Pay Karyawan (terima gaji asli)', value: fmt(brutoAsli) },
      { label: 'Total Biaya Perusahaan (bruto baru)', value: fmt(brutoBaru) },
    ];

  } else {
    const rate     = getTERRate(brutoAsli, kat);
    const pph      = Math.round(brutoAsli * (rate / 100));
    const takehome = skema === 'gross' ? brutoAsli - pph : brutoAsli;

    rows = [
      { label: 'Masa Pajak', value: masaLabel },
      { label: 'Kategori TER', value: `Kategori ${kat} â€” ${katInfo.desc}` },
      { label: 'Penghasilan Bruto Sebulan', value: fmt(brutoAsli) },
      { label: `Tarif TER Kategori ${kat}`, value: rate + '%' },
      { label: 'PPh 21 Terutang', value: fmt(pph), total: true },
      ...(skema === 'netto' ? [
        { label: 'PPh Ditanggung Perusahaan (biaya tambahan)', value: fmt(pph) },
        { label: 'Take Home Pay Karyawan (terima penuh)', value: fmt(brutoAsli) },
        { label: 'Total Biaya Perusahaan (bruto + PPh)', value: fmt(brutoAsli + pph) },
      ] : [
        { label: 'Take Home Pay Karyawan (Bruto âˆ’ PPh)', value: fmt(takehome) },
      ]),
    ];
  }

  renderTable('tableTER', rows);
  document.getElementById('resultTER').style.display = 'block';
}

// â”€â”€ PPH 21: TIDAK TETAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hitungNonTetap() {
  const jenis  = document.getElementById('nt_jenis').value;
  const skema  = document.getElementById('nt_skema').value;
  const ptkpRaw = document.getElementById('nt_ptkp').value;
  const ptkp   = parseInt(ptkpRaw.replace('_k',''));

  document.getElementById('nt_card_harian').style.display  = jenis === 'ptt_harian'  ? 'block' : 'none';
  document.getElementById('nt_card_bulanan').style.display = jenis === 'ptt_bulanan' ? 'block' : 'none';

  // Skema info boxes
  document.getElementById('nt_gu_box').style.display    = skema === 'gross_up' ? 'block' : 'none';
  document.getElementById('nt_netto_box').style.display = skema === 'netto'    ? 'block' : 'none';
  document.getElementById('nt_gu_icon').style.display   = skema === 'gross_up' ? 'inline-flex' : 'none';

  let rows = [];
  const hide = () => document.getElementById('resultNonTetap').style.display = 'none';

  // Helper: hitung PPh per hari berdasarkan upah harian
  // Kode 21-100-24: â‰¤ 2.500.000/hari (TER Harian 0% atau 0,5%)
  // Kode 21-100-30: > 2.500.000/hari (DPP 50% Ã— upah, Tarif Psl 17)
  // PMK 168/2023 Pasal 16 ayat (2) huruf c: Tarif Psl 17 Ã— DPP per hari â€” TANPA annualisasi
  function calcPPHHarian(upah) {
    if (upah <= 450000) return 0;
    if (upah <= 2500000) return upah * 0.005;
    // > 2.500.000: DPP = 50% Ã— upah harian, langsung kena tarif Psl 17 (tidak disetahunkan)
    return tarifPPh21(upah * 0.5);
  }

  // â”€â”€ Upah Harian â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (jenis === 'ptt_harian') {
    const upahAsli  = parseFloat(document.getElementById('nt_upah_hari').value)  || 0;
    const hariKerja = parseFloat(document.getElementById('nt_hari_kerja').value) || 0;
    if (!upahAsli || !hariKerja) { hide(); return; }

    const isPS17 = upahAsli > 2500000;
    const kodeCoretax = isPS17 ? '21-100-30' : '21-100-24';

    if (skema === 'gross_up') {
      let upahBaru = upahAsli;
      for (let i = 0; i < 300; i++) {
        const pphBaru  = calcPPHHarian(upahBaru);
        const upahNext = upahAsli + pphBaru;
        if (Math.abs(upahNext - upahBaru) < 0.01) { upahBaru = upahNext; break; }
        upahBaru = upahNext;
      }
      upahBaru = Math.round(upahBaru);
      const tunjanganPerHari = upahBaru - upahAsli;
      const pphPerHari       = Math.round(calcPPHHarian(upahBaru));
      const pphTotal         = pphPerHari * hariKerja;
      const metode           = upahBaru > 2500000 ? `Kode ${kodeCoretax} â€” Tarif Psl 17 Ã— 50% Ã— Upah`
                             : upahBaru > 450000   ? `Kode ${kodeCoretax} â€” TER 0,5%`
                             :                       `Kode ${kodeCoretax} â€” TER 0%`;

      rows = [
        { label: 'Kode Objek Pajak Coretax',               value: kodeCoretax },
        { label: 'Upah Asli per Hari',                     value: fmt(upahAsli) },
        { label: 'âœ¦ Tunjangan PPh Gross Up per Hari',      value: fmt(tunjanganPerHari) },
        { label: 'Upah Baru per Hari (termasuk tunjangan)', value: fmt(upahBaru) },
        { label: 'Jumlah Hari Kerja',                       value: hariKerja + ' hari' },
        { label: 'Metode',                                  value: metode },
        ...(isPS17 ? [{ label: 'DPP per Hari (50% Ã— Upah Baru)', value: fmt(upahBaru * 0.5) }] : []),
        { label: 'PPh per Hari (= Tunjangan PPh per Hari)', value: fmt(pphPerHari) },
        { label: 'PPh 21 Terutang (PPh/hari Ã— Hari)',      value: fmt(pphTotal), total: true },
        { label: 'Take Home Pay (terima upah asli)',        value: fmt(upahAsli * hariKerja) },
        { label: 'Total Biaya Perusahaan',                  value: fmt(upahBaru * hariKerja) },
      ];

    } else {
      let metode = '', pphPerHari = 0;
      if (upahAsli <= 450000) {
        metode = `Kode 21-100-24 â€” TER 0% (Upah â‰¤ Rp450.000/hari)`; pphPerHari = 0;
      } else if (upahAsli <= 2500000) {
        metode = `Kode 21-100-24 â€” TER 0,5% Ã— Upah Harian`; pphPerHari = upahAsli * 0.005;
      } else {
        metode = `Kode 21-100-30 â€” Tarif Psl 17 Ã— DPP (50% Ã— Upah Harian)`;
        pphPerHari = tarifPPh21(upahAsli * 0.5);
      }
      const pphTotal  = Math.round(pphPerHari * hariKerja);
      const kumulatif = upahAsli * hariKerja;
      const takehome  = skema === 'gross' ? kumulatif - pphTotal : kumulatif;

      rows = [
        { label: 'Kode Objek Pajak Coretax',               value: kodeCoretax },
        { label: 'Upah per Hari',                          value: fmt(upahAsli) },
        { label: 'Jumlah Hari Kerja',                      value: hariKerja + ' hari' },
        { label: 'Total Upah Bulan Ini',                   value: fmt(kumulatif) },
        { label: 'Metode Pemotongan',                      value: metode },
        ...(isPS17 ? [
          { label: 'DPP per Hari (50% Ã— Upah)',            value: fmt(upahAsli * 0.5) },
          { label: 'PPh per Hari (tarif progresif Psl 17)', value: fmt(pphPerHari) },
        ] : upahAsli > 450000 ? [
          { label: 'PPh per Hari (0,5% Ã— upah)',           value: fmt(pphPerHari) },
        ] : []),
        { label: 'PPh 21 Terutang (PPh/hari Ã— Hari)',      value: fmt(pphTotal), total: true },
        ...(skema === 'netto' ? [
          { label: 'PPh Ditanggung Perusahaan',            value: fmt(pphTotal) },
          { label: 'Take Home Pay (terima upah penuh)',     value: fmt(kumulatif) },
          { label: 'Total Biaya Perusahaan (upah + PPh)',  value: fmt(kumulatif + pphTotal) },
        ] : [
          { label: 'Take Home Pay (Total Upah âˆ’ PPh)',     value: fmt(takehome) },
        ]),
      ];
    }

  // â”€â”€ Upah Bulanan â€” Kode 21-100-35, TER Bulanan â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  } else if (jenis === 'ptt_bulanan') {
    const brutoAsli = parseFloat(document.getElementById('nt_upah_bulanan').value) || 0;
    if (!brutoAsli) { hide(); return; }

    // Derive TER kategori dari PTKP
    let terKat = 'A';
    if (ptkpRaw.includes('63000000_k') || ptkpRaw.includes('67500000_k') || ptkpRaw.startsWith('72000000')) terKat = 'C';
    else if (ptkpRaw.includes('_k') || ptkpRaw.startsWith('58500000') || ptkpRaw.startsWith('63000000') || ptkpRaw.startsWith('67500000')) terKat = 'B';

    if (skema === 'gross_up') {
      let T = 0;
      for (let i = 0; i < 300; i++) {
        const brutoBaru = brutoAsli + T;
        const rateBaru  = getTERRate(brutoBaru, terKat);
        const pphBaru   = Math.round(brutoBaru * (rateBaru / 100));
        if (Math.abs(pphBaru - T) < 1) { T = pphBaru; break; }
        T = pphBaru;
      }
      const tunjanganPPh = T;
      const brutoBaru    = brutoAsli + tunjanganPPh;
      const rateFinal    = getTERRate(brutoBaru, terKat);
      const pphTER       = Math.round(brutoBaru * (rateFinal / 100));

      rows = [
        { label: 'Kode Objek Pajak Coretax',               value: '21-100-35' },
        { label: 'Metode',                                  value: `TER Bulanan Kategori ${terKat} (Gross Up)` },
        { label: 'Penghasilan Bruto Asli Sebulan',          value: fmt(brutoAsli) },
        { label: 'âœ¦ Tunjangan PPh Gross Up',               value: fmt(tunjanganPPh) },
        { label: 'Bruto Baru (incl. tunjangan PPh)',        value: fmt(brutoBaru) },
        { label: `Tarif TER Kategori ${terKat}`,           value: rateFinal + '%' },
        { label: 'PPh 21 Terutang (= Tunjangan PPh)',      value: fmt(pphTER), total: true },
        { label: 'Take Home Pay (terima bruto asli)',       value: fmt(brutoAsli) },
        { label: 'Total Biaya Perusahaan',                  value: fmt(brutoBaru) },
      ];

    } else {
      const terRate = getTERRate(brutoAsli, terKat);
      const pphTER  = Math.round(brutoAsli * (terRate / 100));
      const takehome = skema === 'gross' ? brutoAsli - pphTER : brutoAsli;

      rows = [
        { label: 'Kode Objek Pajak Coretax',              value: '21-100-35' },
        { label: 'Metode',                                 value: `TER Bulanan Kategori ${terKat}` },
        { label: 'Penghasilan Bruto Sebulan',             value: fmt(brutoAsli) },
        { label: `Tarif TER Kategori ${terKat}`,         value: terRate + '%' },
        { label: 'PPh 21 Terutang',                       value: fmt(pphTER), total: true },
        ...(skema === 'netto' ? [
          { label: 'PPh Ditanggung Perusahaan',           value: fmt(pphTER) },
          { label: 'Take Home Pay (terima bruto penuh)',   value: fmt(brutoAsli) },
          { label: 'Total Biaya Perusahaan',               value: fmt(brutoAsli + pphTER) },
        ] : [
          { label: 'Take Home Pay',                       value: fmt(takehome) },
        ]),
      ];
    }
  }

  if (rows.length) {
    renderTable('tableNonTetap', rows);
    document.getElementById('resultNonTetap').style.display = 'block';
  }
}

// â”€â”€ PPH 21: BUKAN PEGAWAI (PMK 168/2023 â€” NON-KUMULATIF) â”€
// Deemed factor per kode Coretax: 50% untuk jasa (Tarif Psl 17 Ã— 50% Ã— bruto)
//                                 100% untuk peserta kegiatan (Tarif Psl 17 Ã— 100% Ã— bruto)
const BP_DEEMED = {
  '21-100-07': 50, '21-100-07-rs': 50, '21-100-33': 50, '21-100-34': 50,
  '21-100-18': 50, '21-100-19': 50, '21-100-20': 50, '21-100-21': 50,
  '21-100-22': 50, '21-100-23': 50, '21-100-06': 50, '21-100-05': 50,
  '21-100-04': 50,
  '21-100-36': 100, '21-100-14': 100, '21-100-15': 100,
  '21-100-16': 100, '21-100-17': 100, '21-100-12': 100,
};

function hitungBP() {
  const jenis  = document.getElementById('bp_jenis').value;
  const skema  = document.getElementById('bp_skema').value;
  const bruto  = parseFloat(document.getElementById('bp_bruto').value)    || 0;

  // Info notes per jenis
  document.getElementById('bp_dokter_note').style.display  = jenis === '21-100-07-rs' ? 'block' : 'none';
  const deemed = BP_DEEMED[jenis] || 50;
  document.getElementById('bp_dpp100_note').style.display  = deemed === 100 ? 'block' : 'none';

  // Skema info boxes
  document.getElementById('bp_gu_box').style.display    = skema === 'gross_up' ? 'block' : 'none';
  document.getElementById('bp_netto_box').style.display = skema === 'netto'    ? 'block' : 'none';
  document.getElementById('bp_gu_icon').style.display   = skema === 'gross_up' ? 'inline-flex' : 'none';

  const hide = () => document.getElementById('resultBP').style.display = 'none';
  if (!bruto) { hide(); return; }

  const brutoBersihAsli = bruto;
  const deemedLabel = deemed === 50 ? '50%' : '100%';

  // Helper: hitung PPh BP atas bruto bersih tertentu
  function calcPPHBP(bb) {
    return tarifPPh21(bb * (deemed / 100));
  }

  const jenisKode = jenis.replace('-rs', ''); // strip suffix for display

  let rows = [];

  if (skema === 'gross_up') {
    // Iterasi: cari bruto_baru sehingga PPh(bruto_baru) = bruto_baru - bruto_bersih_asli
    let brutoBaru = brutoBersihAsli;
    for (let i = 0; i < 300; i++) {
      const pphBaru   = calcPPHBP(brutoBaru);
      const brutoNext = brutoBersihAsli + pphBaru;
      if (Math.abs(brutoNext - brutoBaru) < 0.01) { brutoBaru = brutoNext; break; }
      brutoBaru = brutoNext;
    }
    brutoBaru = Math.round(brutoBaru);
    const tambahanHonorar = brutoBaru - brutoBersihAsli;
    const dppBaru  = brutoBaru * (deemed / 100);
    const pphAkhir = Math.round(tarifPPh21(dppBaru));

    rows = [
      { label: 'Kode Objek Pajak Coretax', value: jenisKode },
      { label: 'Deemed / DPP',             value: `${deemedLabel} Ã— Bruto` },
      { label: '1. Honorarium Asli',       value: fmt(bruto) },
      { label: `âœ¦ Tambahan Honorarium Gross Up`,   value: fmt(tambahanHonorar) },
      { label: 'Honorarium Baru (Bruto Gross Up)', value: fmt(brutoBaru) },
      { label: `DPP (${deemedLabel} Ã— Bruto Baru)`, value: fmt(dppBaru) },
      { label: 'PPh 21 Dipotong (= Tambahan Honorarium)', value: fmt(pphAkhir), total: true },
      { label: 'Diterima Bukan Pegawai (= honorarium asli)', value: fmt(bruto) },
      { label: 'Total Biaya Pemberi Kerja', value: fmt(brutoBaru) },
    ];

  } else {
    const dpp      = brutoBersihAsli * (deemed / 100);
    const pphAkhir = Math.round(tarifPPh21(dpp));
    const terima   = skema === 'gross' ? bruto - pphAkhir : bruto;

    rows = [
      { label: 'Kode Objek Pajak Coretax',         value: jenisKode },
      { label: 'Deemed / DPP',                     value: `${deemedLabel} Ã— Bruto` },
      { label: '1. Penghasilan Bruto',             value: fmt(bruto) },
      { label: `2. DPP (${deemedLabel} Ã— Penghasilan Bruto)`, value: fmt(dpp) },
      { label: 'Tarif',         value: 'Tarif Progresif Psl 17 UU PPh' },
      { label: 'PPh 21 Terutang', value: fmt(pphAkhir), total: true },
      ...(skema === 'netto' ? [
        { label: 'PPh Ditanggung Pemberi Kerja',          value: fmt(pphAkhir) },
        { label: 'Diterima Bukan Pegawai (bruto penuh)',   value: fmt(bruto) },
        { label: 'Total Biaya Pemberi Kerja (bruto + PPh)', value: fmt(bruto + pphAkhir) },
      ] : [
        { label: 'Penghasilan Bersih Diterima (Bruto âˆ’ PPh)', value: fmt(terima) },
      ]),
    ];
  }

  renderTable('tableBP', rows);
  document.getElementById('resultBP').style.display = 'block';
}

// â”€â”€ PPH 23 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hitung23() {
  const input  = parseFloat(document.getElementById('pph23_bruto').value) || 0;
  const jenisVal = document.getElementById('pph23_jenis').value;
  const skema  = document.getElementById('pph23_skema').value;

  const [kode, tarifStr] = jenisVal.split('|');
  const tarifPct = parseFloat(tarifStr) || 0;
  const tarif    = tarifPct / 100;
  const tarifLabel = tarifPct + '%';

  const sel = document.getElementById('pph23_jenis');
  const namaJenis = sel.options[sel.selectedIndex].text.replace(/^[\d-]+ \| /, '');

  const isGrossUp = skema === 'gross_up';
  const isNetto   = skema === 'netto';
  document.getElementById('pph23_input_label').textContent = isGrossUp
    ? 'Nilai Neto yang Ingin Diterima (Rp)'
    : 'Penghasilan Bruto (Rp)';
  document.getElementById('pph23_tarif_info').textContent = `[${kode}] Tarif: ${tarifLabel}`;
  document.getElementById('pph23_gu_icon').style.display  = isGrossUp ? 'inline-flex' : 'none';
  document.getElementById('pph23_gu_box').style.display   = isGrossUp ? 'block' : 'none';
  document.getElementById('pph23_netto_box').style.display = isNetto  ? 'block' : 'none';

  if (input === 0) { document.getElementById('result23').style.display = 'none'; return; }

  let bruto, pph, neto, totalBeban;

  if (isGrossUp) {
    neto       = input;
    bruto      = tarif < 1 ? neto / (1 - tarif) : neto;
    pph        = bruto - neto;
    totalBeban = bruto;
  } else if (isNetto) {
    bruto      = input;
    pph        = bruto * tarif;
    neto       = bruto;
    totalBeban = bruto + pph;
  } else {
    bruto      = input;
    pph        = bruto * tarif;
    neto       = bruto - pph;
    totalBeban = bruto;
  }

  let rows = [];

  if (isGrossUp) {
    rows = [
      { label: 'Kode Objek Pajak Coretax', value: kode },
      { label: 'Jenis Penghasilan',         value: namaJenis },
      { label: 'Nilai Neto yang Ingin Diterima', value: fmt(neto) },
      { label: `âœ¦ PPh 23 Gross Up (${tarifLabel})`, value: fmt(pph) },
      { label: 'Penghasilan Bruto (setelah dinaikkan)', value: fmt(bruto) },
      { label: 'PPh 23 yang Dipotong', value: fmt(pph) },
      { label: 'Nilai Bersih Diterima Penerima', value: fmt(neto), total: true },
    ];
  } else if (isNetto) {
    rows = [
      { label: 'Kode Objek Pajak Coretax', value: kode },
      { label: 'Jenis Penghasilan',         value: namaJenis },
      { label: 'Penghasilan Bruto', value: fmt(bruto) },
      { label: `PPh 23 (${tarifLabel}) â€” Ditanggung Pemberi`, value: fmt(pph) },
      { label: 'Nilai Bersih Diterima Penerima', value: fmt(neto) },
      { label: 'Total Beban Pemberi (Bruto + PPh)', value: fmt(totalBeban), total: true },
    ];
  } else {
    rows = [
      { label: 'Kode Objek Pajak Coretax', value: kode },
      { label: 'Jenis Penghasilan',         value: namaJenis },
      { label: 'Penghasilan Bruto', value: fmt(bruto) },
      { label: `PPh 23 (${tarifLabel}) â€” Dipotong dari Penerima`, value: fmt(pph) },
      { label: 'Nilai Bersih Diterima Penerima', value: fmt(neto), total: true },
    ];
  }

  renderTable('table23', rows);
  document.getElementById('result23').style.display = 'block';
}

// â”€â”€ PPH 4(2) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hitung4() {
  const input  = parseFloat(document.getElementById('pph4_bruto').value) || 0;
  const jenisVal = document.getElementById('pph4_jenis').value;
  const skema  = document.getElementById('pph4_skema').value;

  const [kode, tarifStr] = jenisVal.split('|');
  const tarifPct  = parseFloat(tarifStr) || 0;
  const tarif     = tarifPct / 100;
  const tarifLabel = tarifPct + '%';

  const sel = document.getElementById('pph4_jenis');
  const namaJenis = sel.options[sel.selectedIndex].text.replace(/^[\d-]+ \| /, '');

  const isGrossUp = skema === 'gross_up';
  const isNetto   = skema === 'netto';

  document.getElementById('pph4_input_label').textContent = isGrossUp
    ? 'Nilai Neto yang Ingin Diterima (Rp)'
    : 'Penghasilan Bruto / Nilai Transaksi (Rp)';
  document.getElementById('pph4_tarif_info').textContent = `[${kode}] Tarif: ${tarifLabel} (Final)`;
  document.getElementById('pph4_gu_icon').style.display  = isGrossUp ? 'inline-flex' : 'none';
  document.getElementById('pph4_gu_box').style.display   = isGrossUp ? 'block' : 'none';
  document.getElementById('pph4_netto_box').style.display = isNetto  ? 'block' : 'none';

  if (input === 0) { document.getElementById('result4').style.display = 'none'; return; }

  let bruto, pph, neto, totalBeban;

  if (isGrossUp) {
    neto       = input;
    bruto      = tarif < 1 ? neto / (1 - tarif) : neto;
    pph        = bruto - neto;
    totalBeban = bruto;
  } else if (isNetto) {
    bruto      = input;
    pph        = bruto * tarif;
    neto       = bruto;
    totalBeban = bruto + pph;
  } else {
    bruto      = input;
    pph        = bruto * tarif;
    neto       = bruto - pph;
    totalBeban = bruto;
  }

  let rows = [];
  if (isGrossUp) {
    rows = [
      { label: 'Kode Objek Pajak Coretax', value: kode },
      { label: 'Jenis Penghasilan',         value: namaJenis },
      { label: 'Nilai Neto yang Ingin Diterima', value: fmt(neto) },
      { label: `âœ¦ PPh 4(2) Gross Up (${tarifLabel})`, value: fmt(pph) },
      { label: 'Penghasilan Bruto (setelah dinaikkan)', value: fmt(bruto) },
      { label: 'PPh 4(2) Final yang Dipotong', value: fmt(pph) },
      { label: 'Nilai Bersih Diterima Penerima', value: fmt(neto), total: true },
    ];
  } else if (isNetto) {
    rows = [
      { label: 'Kode Objek Pajak Coretax', value: kode },
      { label: 'Jenis Penghasilan',         value: namaJenis },
      { label: 'Penghasilan Bruto', value: fmt(bruto) },
      { label: `PPh 4(2) Final (${tarifLabel}) â€” Ditanggung Pemotong`, value: fmt(pph) },
      { label: 'Nilai Bersih Diterima Penerima', value: fmt(neto) },
      { label: 'Total Beban Pemotong (Bruto + PPh)', value: fmt(totalBeban), total: true },
    ];
  } else {
    rows = [
      { label: 'Kode Objek Pajak Coretax', value: kode },
      { label: 'Jenis Penghasilan',         value: namaJenis },
      { label: 'Nilai Transaksi / Penghasilan Bruto', value: fmt(bruto) },
      { label: `PPh 4(2) Final (${tarifLabel}) â€” Dipotong dari Penerima`, value: fmt(pph) },
      { label: 'Nilai Bersih Diterima Penerima', value: fmt(neto), total: true },
    ];
  }

  renderTable('table4', rows);
  document.getElementById('result4').style.display = 'block';
}

// â”€â”€ PPH BADAN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hitungBadan() {
  const pb = parseFloat(document.getElementById('pb_peredaran').value) || 0;
  const pkp = parseFloat(document.getElementById('pb_pkp').value) || 0;
  const jenis = document.getElementById('pb_jenis').value;

  if (pb === 0 || pkp === 0) { document.getElementById('resultBadan').style.display = 'none'; return; }

  let pph = 0;
  let keterangan = '';
  let tarif1 = 0, tarif2 = 0, pkpFasilitas = 0, pkpNonFasilitas = 0;

  if (jenis === 'tbk') {
    // Perusahaan Tbk: 19%
    pph = pkp * 0.19;
    keterangan = '19% (Perusahaan Tbk)';
  } else if (pb <= 4800000000) {
    // Seluruh PKP dapat fasilitas 50% pengurangan tarif â†’ 11%
    pph = pkp * 0.11;
    keterangan = '11% (Fasilitas Pasal 31E â€” Peredaran Bruto â‰¤ Rp 4,8 M)';
  } else if (pb <= 50000000000) {
    // Proporsional: sebagian 11%, sebagian 22%
    pkpFasilitas = (4800000000 / pb) * pkp;
    pkpNonFasilitas = pkp - pkpFasilitas;
    tarif1 = pkpFasilitas * 0.11;
    tarif2 = pkpNonFasilitas * 0.22;
    pph = tarif1 + tarif2;
    keterangan = 'Proporsional 11% + 22%';
  } else {
    // Semua 22%
    pph = pkp * 0.22;
    keterangan = '22% (Peredaran Bruto > Rp 50 M)';
  }

  const rows = [];
  rows.push({ label: 'Peredaran Bruto', value: fmt(pb) });
  rows.push({ label: 'Penghasilan Kena Pajak (PKP)', value: fmt(pkp) });
  rows.push({ label: 'Skema Tarif', value: keterangan });

  if (pkpFasilitas > 0) {
    rows.push({ label: `PKP Dapat Fasilitas (11%)`, value: fmt(pkpFasilitas) });
    rows.push({ label: `PPh atas PKP Fasilitas`, value: fmt(tarif1) });
    rows.push({ label: `PKP Non-Fasilitas (22%)`, value: fmt(pkpNonFasilitas) });
    rows.push({ label: `PPh atas PKP Non-Fasilitas`, value: fmt(tarif2) });
  }

  rows.push({ label: 'PPh Badan Terutang', value: fmt(pph), total: true });

  renderTable('tableBadan', rows);
  document.getElementById('resultBadan').style.display = 'block';
}

// â”€â”€ PPN (PMK 131/2024 + PMK 11/2025) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//
// SKEMA BERLAKU (mulai 1 Jan 2025):
// 1. Non-Mewah  â†’ DPP = 11/12 Ã— Harga â†’ PPN = 12% Ã— 11/12 = efektif 11%
// 2. Mewah      â†’ DPP = Harga penuh   â†’ PPN = 12%
// 3. Ekspor     â†’ Tarif 0%
// 4. Besaran Tertentu (PMK 11/2025):
//      PPN = faktor% Ã— 11/12 Ã— 12% Ã— Nilai Transaksi
//      = faktor% Ã— 11% Ã— Nilai Transaksi
//
// PMK 11/2025 berlaku sejak 4 Feb 2025, retroaktif 1 Jan 2025
// (menggantikan PMK 71/2022, PMK 121/2015, dll.)
//
const PPN_BESARAN = {
  jasa_pengiriman:    { faktor: 10, label: 'Jasa Pengiriman Paket',                    dasar: 'PMK 11/2025 jo. PMK 71/2022' },
  biro_perjalanan:    { faktor: 10, label: 'Jasa Biro/Agen Perjalanan Wisata',          dasar: 'PMK 11/2025 jo. PMK 71/2022' },
  freight_forwarding: { faktor: 10, label: 'Jasa Pengurusan Transportasi (Freight Forwarding)', dasar: 'PMK 11/2025 jo. PMK 71/2022' },
  voucher_marketing:  { faktor: 10, label: 'Jasa Penyelenggaraan Pemasaran dg Voucer', dasar: 'PMK 11/2025 jo. PMK 71/2022' },
  ibadah_dirinci:     { faktor: 10, label: 'Jasa Perjalanan Ibadah Keagamaan (Tagihan Dirinci)',    dasar: 'PMK 11/2025 jo. PMK 71/2022' },
  ibadah_tidakdirinci:{ faktor: 5,  label: 'Jasa Perjalanan Ibadah Keagamaan (Tagihan Tidak Dirinci)', dasar: 'PMK 11/2025 jo. PMK 71/2022' },
  emas_konsumen:      { faktor: 15, label: 'Emas Perhiasan â€” Pabrikan/Pedagang ke Konsumen Akhir', dasar: 'PMK 11/2025 jo. PMK 48/2023' },
  emas_antar_pkp:     { faktor: 10, label: 'Emas Perhiasan â€” Antar PKP (Pabrikan ke Pabrikan/Pedagang)', dasar: 'PMK 11/2025 jo. PMK 48/2023' },
  kms:                { faktor: 20, label: 'Kegiatan Membangun Sendiri (KMS)',          dasar: 'PMK 11/2025 (PMK 81/2024)' },
  pertanian:          { faktor: 10, label: 'Barang Hasil Pertanian Tertentu',           dasar: 'PMK 11/2025 jo. PMK 64/2022' },
  kendaraan_bekas:    { faktor: 10, label: 'Kendaraan Bermotor Bekas',                 dasar: 'PMK 11/2025 jo. PMK 65/2022' },
  ayda:               { faktor: 10, label: 'Agunan yang Diambil Alih (AYDA)',           dasar: 'PMK 11/2025 jo. PMK 41/2023' },
  pemakaian_sendiri:  { faktor: 100, label: 'Pemakaian Sendiri / Pemberian Cuma-Cuma (DPP = HPP)', dasar: 'PMK 11/2025 jo. PMK 75/2010' },
};

function switchPPNSkema() {
  const skema = document.getElementById('ppn_skema').value;
  const nilLainField = document.getElementById('ppn_nilailain_field');
  const infoBox      = document.getElementById('ppn_info_box');
  const inputLbl     = document.getElementById('ppn_input_label');

  nilLainField.style.display = skema === 'nilai_lain' ? 'block' : 'none';

  const infoMap = {
    non_mewah:  'âš–ï¸ <b>PMK 131/2024 Pasal 3:</b> BKP/JKP Non-Mewah â†’ <b>DPP Nilai Lain = 11/12 Ã— Harga Jual</b><br>PPN = 12% Ã— 11/12 Ã— Harga = <b>efektif 11%</b>. Tarif UU 12%, beban nyata tetap 11%.',
    mewah:      'ğŸ’ <b>PMK 131/2024 Pasal 2:</b> BKP Mewah (PPnBM) â†’ <b>DPP = Harga Jual Penuh</b><br>PPN = <b>12% langsung</b>. Berlaku mulai 1 Februari 2025 untuk penyerahan ke konsumen akhir.',
    ekspor:     'âœˆï¸ <b>Ekspor BKP/JKP:</b> Tarif PPN <b>0%</b> sesuai Pasal 7 ayat (2) UU PPN.',
    nilai_lain: 'ğŸ“‹ <b>PMK 11/2025</b> (berlaku 1 Jan 2025): Omnibus DPP Nilai Lain &amp; Besaran Tertentu.<br>Formula: <b>Faktor% Ã— 11/12 Ã— 12% Ã— Nilai Transaksi</b> = Faktor% Ã— 11% Ã— Nilai.<br>Contoh jasa pengiriman: 10% Ã— 11/12 Ã— 12% = <b>efektif 1,1%</b>.',
  };
  infoBox.innerHTML = 'â„¹ï¸ ' + (infoMap[skema] || '');

  inputLbl.textContent = skema === 'ekspor'     ? 'Nilai Ekspor (Rp)'
    : skema === 'nilai_lain' ? 'Nilai Transaksi / Tagihan Sudah Termasuk PPN (Rp)'
    : skema === 'mewah'      ? 'Harga Jual BKP Mewah Sudah Termasuk PPN (Rp)'
    : 'Harga / Nilai Transaksi Sudah Termasuk PPN (Rp)';

  document.getElementById('ppn_dpp').placeholder = skema === 'nilai_lain'
    ? '0  (isi nilai transaksi/tagihan penuh termasuk PPN)'
    : skema === 'mewah' ? '0  (harga jual penuh sudah termasuk PPN)'
    : skema === 'ekspor' ? '0'
    : '0  (isi harga sudah termasuk PPN)';

  hitungPPN();
}

function hitungPPN() {
  const nilaiInput = parseFloat(document.getElementById('ppn_dpp').value) || 0;
  const skema = document.getElementById('ppn_skema').value;
  const hide  = () => { document.getElementById('resultPPN').style.display = 'none'; };

  if (!nilaiInput) { hide(); return; }

  // Semua mode: input = harga SUDAH TERMASUK PPN (pisahkan PPN)
  let rows = [];

  // â”€â”€ 1. BKP/JKP Non-Mewah (PMK 131/2024 Pasal 3) â”€â”€â”€â”€â”€â”€
  if (skema === 'non_mewah') {
    // total = H Ã— 1.11 â†’ H = total / 1.11
    const total        = nilaiInput;
    const hargaJual    = total / 1.11;
    const dppNilaiLain = hargaJual * (11 / 12);
    const ppn          = total - hargaJual;
    const efektifPct   = (ppn / hargaJual * 100).toFixed(2);

    rows = [
      { label: 'Dasar Regulasi',                          value: 'PMK 131/2024 Pasal 3 â€” BKP/JKP Non-Mewah' },
      { label: 'Total Harga Input (include PPN)',          value: fmt(total) },
      { label: 'Harga Jual (ekskl. PPN)',                  value: fmt(hargaJual) },
      { label: 'DPP Nilai Lain (11/12 Ã— Harga)',          value: fmt(dppNilaiLain) },
      { label: 'Tarif PPN (sesuai UU)',                   value: '12%' },
      { label: 'PPN Terutang (12% Ã— DPP Nilai Lain)',     value: fmt(ppn), total: true },
      { label: 'Tarif Efektif PPN',                       value: efektifPct + '% â‰ˆ 11%' },
      { label: 'Selisih vs PPN 12% atas harga penuh (penghematan)', value: fmt(hargaJual * 0.12 - ppn) },
    ];

  // â”€â”€ 2. BKP Mewah â€” PMK 131/2024 Pasal 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  } else if (skema === 'mewah') {
    // total = H Ã— 1.12 â†’ H = total / 1.12
    const total     = nilaiInput;
    const hargaJual = total / 1.12;
    const ppn       = total - hargaJual;

    rows = [
      { label: 'Dasar Regulasi',                        value: 'PMK 131/2024 Pasal 2 â€” BKP Mewah (PPnBM)' },
      { label: 'Total Harga Input (include PPN)',        value: fmt(total) },
      { label: 'Harga Jual BKP Mewah (ekskl. PPN)',     value: fmt(hargaJual) },
      { label: 'DPP',                                   value: 'Harga Jual Penuh (tanpa diskon nilai lain)' },
      { label: 'Tarif PPN',                             value: '12%' },
      { label: 'PPN Terutang (12% Ã— Harga Jual)',       value: fmt(ppn) },
      { label: 'Total Harga (termasuk PPN)',             value: fmt(total), total: true },
    ];

  // â”€â”€ 3. Ekspor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  } else if (skema === 'ekspor') {
    rows = [
      { label: 'Dasar Regulasi', value: 'Pasal 7 ayat (2) UU PPN â€” Ekspor BKP/JKP' },
      { label: 'Nilai Ekspor',   value: fmt(nilaiInput) },
      { label: 'Tarif PPN',      value: '0%' },
      { label: 'PPN Terutang',   value: fmt(0), total: true },
    ];

  // â”€â”€ 4. Besaran Tertentu (PMK 11/2025) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  } else if (skema === 'nilai_lain') {
    const jenisKey = document.getElementById('ppn_nilailain_jenis').value;
    const cfg      = PPN_BESARAN[jenisKey];

    if (jenisKey === 'pemakaian_sendiri') {
      // total = HPP Ã— 1.11 â†’ HPP = total / 1.11
      const hpp   = nilaiInput / 1.11;
      const dppNL = hpp * (11 / 12);
      const ppn   = dppNL * 0.12;
      rows = [
        { label: 'Dasar Regulasi',                  value: cfg.dasar },
        { label: 'Jenis',                           value: cfg.label },
        { label: 'Total Input (include PPN)',        value: fmt(nilaiInput) },
        { label: 'DPP (= HPP / Harga Perolehan)',   value: fmt(hpp) },
        { label: 'DPP Nilai Lain (11/12 Ã— HPP)',    value: fmt(dppNL) },
        { label: 'Formula PPN',                     value: '12% Ã— (11/12) Ã— HPP = 11% Ã— HPP' },
        { label: 'PPN Terutang',                    value: fmt(ppn), total: true },
        { label: 'Total (HPP + PPN)',                value: fmt(hpp + ppn) },
        { label: 'Tarif Efektif (atas HPP)',         value: '11%' },
      ];
    } else {
      // total = nilai Ã— (1 + fÃ—11%) â†’ nilai = total / (1 + fÃ—11%)
      const f       = cfg.faktor / 100;
      const efRate  = f * (11 / 12) * 0.12;
      const nilai   = nilaiInput / (1 + efRate);
      const dppNL   = nilai * f;
      const ppn     = nilai * efRate;
      const total   = nilai + ppn;
      const efektif = (efRate * 100).toFixed(2);

      rows = [
        { label: 'Dasar Regulasi',                                        value: cfg.dasar },
        { label: 'Jenis',                                                 value: cfg.label },
        { label: 'Total Input (termasuk PPN)',                            value: fmt(nilaiInput) },
        { label: 'Nilai Transaksi (DPP)',                                 value: fmt(nilai) },
        { label: `DPP Nilai Lain (${cfg.faktor}% Ã— Nilai Transaksi)`,    value: fmt(dppNL) },
        { label: 'Formula PPN Besaran Tertentu',                          value: `${cfg.faktor}% Ã— 11/12 Ã— 12% Ã— Nilai` },
        { label: 'PPN Terutang',                                          value: fmt(ppn), total: true },
        { label: 'Total (Nilai + PPN)',                                   value: fmt(total) },
        { label: 'Tarif Efektif PPN (atas Nilai Transaksi)',               value: `${efektif}%  = ${cfg.faktor}% Ã— 11%` },
      ];
    }
  }

  renderTable('tablePPN', rows);
  document.getElementById('resultPPN').style.display = 'block';
}

// â”€â”€ PPnBM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hitungPPnBM() {
  const dpp = parseFloat(document.getElementById('ppnbm_dpp').value) || 0;
  const jenis = document.getElementById('ppnbm_jenis').value;
  const tarif = parseFloat(jenis) / 100;

  document.getElementById('ppnbm_tarif_info').textContent = `Tarif PPnBM: ${jenis}%`;

  if (dpp === 0) { document.getElementById('resultPPnBM').style.display = 'none'; return; }

  const ppnbm = dpp * tarif;
  const ppn = dpp * 0.12;
  const total = dpp + ppn + ppnbm;

  const rows = [
    { label: 'Harga Jual / DPP', value: fmt(dpp) },
    { label: `PPnBM (${jenis}%)`, value: fmt(ppnbm) },
    { label: `PPN (12%)`, value: fmt(ppn) },
    { label: 'Total yang Dibayar Konsumen', value: fmt(total), total: true },
  ];
  renderTable('tablePPnBM', rows);
  document.getElementById('resultPPnBM').style.display = 'block';
}

// Inisialisasi
hitung21(); hitung23(); hitung4(); hitungPPN(); hitungPPnBM(); hitungTER();

// â”€â”€ PPH 24 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let negaraCounter = 0;

function tambahNegara() {
  negaraCounter++;
  const id = negaraCounter;
  const div = document.createElement('div');
  div.className = 'negara-row';
  div.id = 'negara_' + id;
  div.innerHTML = `
    <div class="field">
      <label>Nama Negara</label>
      <input type="text" id="negara_nama_${id}" placeholder="Contoh: Singapura" oninput="hitungP24()" style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:10px 14px;color:var(--text);font-family:inherit;font-size:0.9rem;width:100%;outline:none;">
    </div>
    <div class="field">
      <label>Penghasilan Neto dari Negara Ini (Rp)</label>
      <input type="number" id="negara_peng_${id}" placeholder="0" oninput="hitungP24()">
    </div>
    <div class="field">
      <label>Pajak Dibayar/Terutang di LN (Rp)</label>
      <input type="number" id="negara_pajak_${id}" placeholder="0" oninput="hitungP24()">
    </div>
    <button class="btn-hapus" onclick="hapusNegara(${id})" title="Hapus">âœ•</button>
  `;
  document.getElementById('p24_negara_list').appendChild(div);
  hitungP24();
}

function hapusNegara(id) {
  const el = document.getElementById('negara_' + id);
  if (el) el.remove();
  hitungP24();
}

function tarifPPh21_p24(pkp) {
  if (pkp <= 0) return 0;
  let pajak = 0;
  const brackets = [[60000000,0.05],[190000000,0.15],[250000000,0.25],[4500000000,0.30]];
  let remaining = pkp;
  for (const [limit, rate] of brackets) {
    if (remaining <= 0) break;
    const taxable = Math.min(remaining, limit);
    pajak += taxable * rate;
    remaining -= taxable;   // â† fix: kurangi yg kena pajak, bukan limit penuh
  }
  if (remaining > 0) pajak += remaining * 0.35;
  return pajak;
}

function hitungP24() {
  const totalNeto = parseFloat(document.getElementById('p24_total_neto').value) || 0;
  const ptkp      = parseFloat(document.getElementById('p24_ptkp').value) || 54000000;

  // Kumpulkan data semua negara
  const rows_el = document.querySelectorAll('.negara-row');
  const negaraData = [];
  rows_el.forEach(row => {
    const id = row.id.replace('negara_', '');
    const nama  = (document.getElementById('negara_nama_' + id)?.value || '').trim() || ('Negara ' + id);
    const peng  = parseFloat(document.getElementById('negara_peng_'  + id)?.value) || 0;
    const pajak = parseFloat(document.getElementById('negara_pajak_' + id)?.value) || 0;
    if (peng > 0 || pajak > 0) negaraData.push({ nama, peng, pajak });
  });

  if (totalNeto === 0 || negaraData.length === 0) {
    document.getElementById('resultP24').style.display = 'none';
    return;
  }

  // Hitung PPh terutang Indonesia atas total penghasilan
  const pkpTotal  = Math.max(totalNeto - ptkp, 0);
  const pphIndo   = tarifPPh21_p24(pkpTotal);

  // Hitung per negara
  let totalKreditMaks = 0;
  let totalPajakLN    = 0;
  let totalKreditDiakui = 0;
  const detailNegara  = [];

  negaraData.forEach(n => {
    // Batas kredit = (Peng LN / Total Peng) Ã— PPh Indonesia
    const batasKredit   = (n.peng / totalNeto) * pphIndo;
    const kreditDiakui  = Math.min(n.pajak, batasKredit);
    totalKreditMaks    += batasKredit;
    totalPajakLN       += n.pajak;
    totalKreditDiakui  += kreditDiakui;
    detailNegara.push({ ...n, batasKredit, kreditDiakui });
  });

  const pphSetelahKredit = Math.max(pphIndo - totalKreditDiakui, 0);

  // Render tabel utama
  const rows = [
    { label: 'Total Penghasilan Neto (DN + LN)', value: fmt(totalNeto) },
    { label: 'PTKP', value: fmt(ptkp) },
    { label: 'Penghasilan Kena Pajak (PKP)', value: fmt(pkpTotal) },
    { label: 'PPh Terutang Indonesia (atas total PKP)', value: fmt(pphIndo) },
    { label: 'Total Pajak Dibayar/Terutang di LN', value: fmt(totalPajakLN) },
    { label: 'Total Batas Kredit Maksimum PPh 24', value: fmt(totalKreditMaks) },
    { label: 'Total Kredit Pajak yang Diakui', value: fmt(totalKreditDiakui) },
    { label: 'PPh Kurang Bayar (setelah kredit PPh 24)', value: fmt(pphSetelahKredit), total: true },
  ];
  renderTable('tableP24', rows);

  // Render detail per negara
  let detailHtml = '';
  if (detailNegara.length > 1 || true) {
    detailNegara.forEach((n, i) => {
      const statusKredit = n.pajak <= n.batasKredit
        ? `<span style="color:var(--accent2);font-weight:700;">âœ“ Seluruh pajak LN diakui</span>`
        : `<span style="color:#f87171;font-weight:700;">âš  Dibatasi â€” selisih Rp ${Math.round(n.pajak - n.batasKredit).toLocaleString('id-ID')} tidak dapat dikreditkan</span>`;
      detailHtml += `
        <div class="p24-negara-detail">
          <div class="negara-nama">ğŸŒ ${n.nama}</div>
          <table class="result-table">
            <tr><td>Penghasilan Neto dari ${n.nama}</td><td style="text-align:right;font-family:'DM Mono',monospace">${fmt(n.peng)}</td></tr>
            <tr><td>Proporsi Penghasilan LN</td><td style="text-align:right;font-family:'DM Mono',monospace">${((n.peng/totalNeto)*100).toFixed(2)}%</td></tr>
            <tr><td>Pajak Dibayar/Terutang di LN</td><td style="text-align:right;font-family:'DM Mono',monospace">${fmt(n.pajak)}</td></tr>
            <tr><td>Batas Kredit Maksimum</td><td style="text-align:right;font-family:'DM Mono',monospace">${fmt(n.batasKredit)}</td></tr>
            <tr class="total"><td>Kredit Pajak Diakui</td><td style="text-align:right;font-family:'DM Mono',monospace;color:var(--accent2)">${fmt(n.kreditDiakui)}</td></tr>
            <tr><td colspan="2" style="padding-top:6px">${statusKredit}</td></tr>
          </table>
        </div>`;
    });
  }
  document.getElementById('p24_detail_negara').innerHTML = detailHtml;
  document.getElementById('resultP24').style.display = 'block';
}

// Auto tambah 1 negara saat pertama kali
tambahNegara();

// â”€â”€ PPH 15 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const P15_TARIF = {
  'penerbangan_dn': { label: '1,8% (efektif, norma 6% Ã— PPh)' },
  'maklon':         { label: '1,75% (efektif, 7% Ã— 25%)' },
};

function hitungP15() {
  const input  = parseFloat(document.getElementById('p15_bruto').value) || 0;
  const jenisVal = document.getElementById('p15_jenis').value;
  const skema  = document.getElementById('p15_skema').value;

  const [kode, tarifStr] = jenisVal.split('|');
  const tarifPct = parseFloat(tarifStr) || 0;
  const tarif    = tarifPct / 100;

  const isLegacy = kode === 'penerbangan_dn' || kode === 'maklon';
  const kodeDisplay = isLegacy ? 'PPh 15' : kode;
  const tarifInfo   = isLegacy
    ? P15_TARIF[kode].label
    : tarifPct.toFixed(2).replace('.', ',').replace(/,?0+$/, '') + '% (efektif)';

  const sel = document.getElementById('p15_jenis');
  const namaJenis = sel.options[sel.selectedIndex].text.replace(/^[\d-]+ \| |^PPh 15 \| /, '');

  const isGrossUp = skema === 'gross_up';
  const isNetto   = skema === 'netto';

  document.getElementById('p15_tarif_info').textContent = `[${kodeDisplay}] Tarif Efektif: ${tarifInfo}`;
  document.getElementById('p15_input_label').textContent = isGrossUp ? 'Nilai Neto yang Ingin Diterima (Rp)' : 'Peredaran Bruto / Imbalan (Rp)';
  document.getElementById('p15_gu_icon').style.display = isGrossUp ? 'inline-flex' : 'none';
  document.getElementById('p15_gu_box').style.display  = isGrossUp ? 'block' : 'none';
  document.getElementById('p15_netto_box').style.display = isNetto  ? 'block' : 'none';

  if (input === 0) { document.getElementById('resultP15').style.display = 'none'; return; }

  let bruto, pph, neto, totalBeban;
  if (isGrossUp) {
    neto = input; bruto = tarif < 1 ? neto / (1 - tarif) : neto; pph = bruto - neto; totalBeban = bruto;
  } else if (isNetto) {
    bruto = input; pph = bruto * tarif; neto = bruto; totalBeban = bruto + pph;
  } else {
    bruto = input; pph = bruto * tarif; neto = bruto - pph; totalBeban = bruto;
  }

  const tarifRow = { label: 'Tarif Efektif PPh 15', value: tarifInfo };

  let rows = [];
  if (isGrossUp) {
    rows = [
      { label: 'Kode Objek Pajak Coretax', value: kodeDisplay },
      { label: 'Jenis',                    value: namaJenis },
      { label: 'Nilai Neto yang Ingin Diterima', value: fmt(neto) },
      { label: `âœ¦ PPh 15 Gross Up (${tarifInfo})`, value: fmt(pph) },
      { label: 'Imbalan Bruto (setelah dinaikkan)', value: fmt(bruto) },
      { label: 'PPh 15 Dipotong', value: fmt(pph) },
      { label: 'Nilai Bersih Diterima Penerima', value: fmt(neto), total: true },
    ];
  } else if (isNetto) {
    rows = [
      { label: 'Kode Objek Pajak Coretax', value: kodeDisplay },
      { label: 'Jenis',                    value: namaJenis },
      { label: 'Peredaran Bruto / Imbalan', value: fmt(bruto) },
      tarifRow,
      { label: `PPh 15 (${tarifInfo}) â€” Ditanggung Pemberi`, value: fmt(pph) },
      { label: 'Nilai Bersih Diterima Penerima', value: fmt(neto) },
      { label: 'Total Beban Pemberi (Bruto + PPh)', value: fmt(totalBeban), total: true },
    ];
  } else {
    rows = [
      { label: 'Kode Objek Pajak Coretax', value: kodeDisplay },
      { label: 'Jenis',                    value: namaJenis },
      { label: 'Peredaran Bruto / Imbalan', value: fmt(bruto) },
      tarifRow,
      { label: `PPh 15`, value: fmt(pph) },
      { label: 'Nilai Bersih Diterima Penerima', value: fmt(neto), total: true },
    ];
  }
  renderTable('tableP15', rows);
  document.getElementById('resultP15').style.display = 'block';
}

// â”€â”€ DATABASE P3B / TAX TREATY INDONESIA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Sumber: Peraturan DJP, DJP Online, SE-03/PJ/2024
// Format: { dividen: [tarif_rendah, tarif_tinggi|null, catatan], bunga: [...], royalti: [...], jasa: [...] }
// dividen: [tarif umum, tarif holding signifikan (biasanya 25%+), catatan]
const P3B_DB = {
  'Algeria':        { dividen:[15,null,''],      bunga:[15,null,''],  royalti:[15,null,''],  jasa:[15,null,''] },
  'Australia':      { dividen:[15,null,''],      bunga:[10,null,''],  royalti:[10,15,'Tergantung jenis royalti'], jasa:[null,null,'Dikenakan sesuai ketentuan domestik masing-masing'] },
  'Austria':        { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,null,''], jasa:[null,null,''] },
  'Bangladesh':     { dividen:[15,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Belarus':        { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Belgium':        { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,null,''], jasa:[null,null,''] },
  'Brunei Darussalam': { dividen:[15,null,''],   bunga:[15,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Bulgaria':       { dividen:[15,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Canada':         { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,null,''], jasa:[null,null,''] },
  'China (RRT)':    { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Croatia':        { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Czech Republic': { dividen:[10,null,''],      bunga:[12.5,null,''],royalti:[12.5,null,''],jasa:[null,null,''] },
  'Denmark':        { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[15,null,''], jasa:[null,null,''] },
  'Egypt':          { dividen:[15,null,''],      bunga:[15,null,''],  royalti:[15,null,''],  jasa:[null,null,''] },
  'Finland':        { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,15,'Tergantung jenis'], jasa:[null,null,''] },
  'France':         { dividen:[15,null,''],      bunga:[15,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Germany':        { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,15,'Tergantung jenis'], jasa:[null,null,''] },
  'Hong Kong':      { dividen:[5,10,'5% jika kepemilikan â‰¥25%'],   bunga:[10,null,''],  royalti:[5,null,''],   jasa:[null,null,''] },
  'Hungary':        { dividen:[15,null,''],      bunga:[15,null,''],  royalti:[15,null,''],  jasa:[null,null,''] },
  'India':          { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[15,null,''], jasa:[null,null,''] },
  'Iran':           { dividen:[7,null,''],       bunga:[10,null,''],  royalti:[12,null,''],  jasa:[null,null,''] },
  'Italy':          { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,15,'Tergantung jenis'], jasa:[null,null,''] },
  'Japan':          { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,null,''], jasa:[null,null,''] },
  'Jordan':         { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Korea Selatan':  { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[15,null,''], jasa:[null,null,''] },
  'Kuwait':         { dividen:[10,null,''],      bunga:[5,null,''],   royalti:[20,null,''],  jasa:[null,null,''] },
  'Luxembourg':     { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,12.5,'Tergantung jenis'], jasa:[null,null,''] },
  'Malaysia':       { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Mexico':         { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Mongolia':       { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Morocco':        { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Netherlands':    { dividen:[5,10,'5% jika kepemilikan â‰¥25%; 10% lainnya; 15% portofolio'], bunga:[10,null,''], royalti:[10,null,''], jasa:[null,null,''] },
  'New Zealand':    { dividen:[15,null,''],      bunga:[10,null,''],  royalti:[15,null,''],  jasa:[null,null,''] },
  'Norway':         { dividen:[15,null,''],      bunga:[10,null,''],  royalti:[10,15,'Tergantung jenis'], jasa:[null,null,''] },
  'Pakistan':       { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[15,null,''], royalti:[15,null,''], jasa:[null,null,''] },
  'Papua Nugini':   { dividen:[15,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Philippines':    { dividen:[15,20,'15% jika kepemilikan â‰¥10%'], bunga:[15,null,''], royalti:[15,null,''], jasa:[null,null,''] },
  'Poland':         { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[15,null,''], jasa:[null,null,''] },
  'Portugal':       { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Qatar':          { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[5,null,''],   jasa:[null,null,''] },
  'Romania':        { dividen:[12.5,null,''],    bunga:[12.5,null,''],royalti:[15,null,''],  jasa:[null,null,''] },
  'Rusia':          { dividen:[15,null,''],      bunga:[15,null,''],  royalti:[15,null,''],  jasa:[null,null,''] },
  'Saudi Arabia':   { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Serbia':         { dividen:[15,null,''],      bunga:[10,null,''],  royalti:[15,null,''],  jasa:[null,null,''] },
  'Seychelles':     { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Singapura':      { dividen:[10,15,'10% jika kepemilikan â‰¥25%; 15% lainnya â€” P3B diperbarui efektif 1 Jan 2022'], bunga:[10,null,'Bunga obligasi pemerintah mengikuti tarif domestik Indonesia (max 10%)'], royalti:[8,10,'8% peralatan industri/ilmiah; 10% karya sastra/seni/film â€” turun dari 15% per 2022'], jasa:[null,null,'Capital gain penjualan saham di bursa Indonesia dikenakan tarif domestik Indonesia'] },
  'Slovakia':       { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,15,'Tergantung jenis'], jasa:[null,null,''] },
  'Afrika Selatan': { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,null,''], jasa:[null,null,''] },
  'Spanyol':        { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,null,''], jasa:[null,null,''] },
  'Sri Lanka':      { dividen:[15,null,''],      bunga:[15,null,''],  royalti:[15,null,''],  jasa:[null,null,''] },
  'Sudan':          { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Suriname':       { dividen:[15,null,''],      bunga:[15,null,''],  royalti:[15,null,''],  jasa:[null,null,''] },
  'Swedia':         { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,15,'Tergantung jenis'], jasa:[null,null,''] },
  'Swiss':          { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,null,''], jasa:[null,null,''] },
  'Syria':          { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[18,null,''],  jasa:[null,null,''] },
  'Taiwan':         { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Thailand':       { dividen:[15,20,'15% jika kepemilikan â‰¥25%'], bunga:[15,25,'15% bank; 25% lainnya'], royalti:[15,null,''], jasa:[null,null,''] },
  'Tunisia':        { dividen:[12,null,''],      bunga:[12,null,''],  royalti:[15,null,''],  jasa:[null,null,''] },
  'Turki':          { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,null,''], jasa:[null,null,''] },
  'Ukraina':        { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,null,''], jasa:[null,null,''] },
  'Uni Emirat Arab':{ dividen:[10,null,''],      bunga:[7,null,'PP 34 Tahun 2021 â€” tarif WHT bunga 7%'],   royalti:[5,null,'Royalti & imbalan jasa teknik 5%'],   jasa:[5,null,'Imbalan jasa teknik 5% (sama dengan royalti)'] },
  'Inggris (UK)':   { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,15,'Tergantung jenis'], jasa:[null,null,''] },
  'Amerika Serikat':{ dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[10,null,''], jasa:[null,null,''] },
  'Uzbekistan':     { dividen:[10,null,''],      bunga:[10,null,''],  royalti:[10,null,''],  jasa:[null,null,''] },
  'Venezuela':      { dividen:[10,15,'10% jika kepemilikan â‰¥25%'], bunga:[10,null,''], royalti:[20,null,''], jasa:[null,null,''] },
  'Vietnam':        { dividen:[15,null,''],      bunga:[15,null,''],  royalti:[15,null,''],  jasa:[null,null,''] },
  'Zimbabwe':       { dividen:[20,null,''],      bunga:[10,null,''],  royalti:[15,null,''],  jasa:[null,null,''] },
};

// Isi & logika searchable dropdown negara P3B
const _p3bNegaraList = Object.keys(P3B_DB).sort();

function renderNegaraList(filter) {
  const list = document.getElementById('p3b_negara_list');
  const q = (filter || '').toLowerCase();
  const matches = q ? _p3bNegaraList.filter(n => n.toLowerCase().includes(q)) : _p3bNegaraList;
  if (!matches.length) {
    list.innerHTML = `<div style="padding:10px 14px;color:#94a3b8;font-size:0.88rem;">Negara tidak ditemukan</div>`;
    return;
  }
  list.innerHTML = matches.map(n =>
    `<div onclick="pilihNegaraP3B('${n}')" style="padding:9px 14px;cursor:pointer;font-size:0.9rem;border-bottom:1px solid var(--border);"
      onmouseover="this.style.background='rgba(255,255,255,0.06)'" onmouseout="this.style.background=''">${n}</div>`
  ).join('');
}

function filterNegaraP3B() {
  const q = document.getElementById('p3b_negara_input').value;
  renderNegaraList(q);
  document.getElementById('p3b_negara_list').style.display = 'block';
  // Clear selection jika user edit ulang
  document.getElementById('p3b_negara').value = '';
  document.getElementById('p3b_result').style.display = 'none';
  document.getElementById('p3b_notfound').style.display = 'none';
}

function showNegaraDropdown() {
  renderNegaraList(document.getElementById('p3b_negara_input').value);
  document.getElementById('p3b_negara_list').style.display = 'block';
}

function hideNegaraDropdown() {
  document.getElementById('p3b_negara_list').style.display = 'none';
}

function pilihNegaraP3B(nama) {
  document.getElementById('p3b_negara_input').value = nama;
  document.getElementById('p3b_negara').value = nama;
  document.getElementById('p3b_negara_list').style.display = 'none';
  lookupP3B();
}

let _p3bTarifSuggested = null;

function lookupP3B() {
  const negara = document.getElementById('p3b_negara').value;
  const jenis  = document.getElementById('p3b_jenis').value;
  const resEl  = document.getElementById('p3b_result');
  const nfEl   = document.getElementById('p3b_notfound');
  const infoEl = document.getElementById('p3b_info');

  resEl.style.display = 'none';
  nfEl.style.display  = 'none';
  _p3bTarifSuggested  = null;

  if (!negara) return;

  const data = P3B_DB[negara];
  if (!data) { nfEl.style.display = 'block'; return; }

  const d = data[jenis];
  const jenisLabel = { dividen:'Dividen', bunga:'Bunga (Interest)', royalti:'Royalti', jasa:'Imbalan Jasa / Technical Services', kapgain:'Capital Gain / Penjualan Harta' }[jenis];

  let html2 = `<strong>ğŸŒ ${negara} â€” ${jenisLabel}</strong><br>`;

  // Capital gain: umumnya mengikuti hukum domestik masing-masing negara
  if (jenis === 'kapgain') {
    const kapgainNotes = {
      'Singapura': 'Berdasarkan P3B update 2022: capital gain atas penjualan saham di bursa Indonesia dikenakan tarif <strong>domestik Indonesia (0,1%)</strong>. Indirect transfer juga diatur.',
      'Australia': 'Capital gain atas alienasi properti tetap dan saham perusahaan properti dikenakan di Indonesia sesuai ketentuan domestik.',
      'Amerika Serikat': 'Capital gain umumnya dikenakan di negara domisili, kecuali untuk real property dan saham perusahaan properti.',
      'Belanda': 'Capital gain atas real property dikenakan di Indonesia. Saham umum di negara domisili.',
    };
    const note = kapgainNotes[negara] || null;
    html2 += note
      ? `<span style="color:var(--accent2);">${note}</span><br><span style="color:#94a3b8;font-size:0.88rem;">â„¹ï¸ Untuk capital gain lainnya â€” umumnya hak pemajakan ada di negara domisili WPLN atau mengikuti hukum domestik Indonesia. Konsultasikan teks P3B untuk detail.</span>`
      : `<span style="color:#94a3b8;">Capital gain umumnya tidak diatur secara khusus dalam P3B ini â€” hak pemajakan mengikuti <b>hukum domestik Indonesia</b> (PPh 26 20%) atau negara domisili tergantung jenis aset. Baca teks P3B untuk ketentuan spesifik.</span>`;
    infoEl.innerHTML = html2;
    resEl.style.display = 'block';
    _p3bTarifSuggested = null; // tidak ada tarif spesifik utk dipakai
    // Hide tombol "pakai tarif" untuk kapgain
    resEl.querySelector('button') && (resEl.querySelector('button').style.display = 'none');
    return;
  }

  // Reset tombol untuk jenis non-kapgain
  resEl.querySelector('button') && (resEl.querySelector('button').style.display = '');

  let html = html2;

  if (d[0] === null) {
    html += `<span style="color:#94a3b8;">Tarif PPh 26 untuk jenis ini tidak diatur khusus dalam P3B â€” berlaku ketentuan domestik negara masing-masing atau tarif umum 20%.</span>`;
    _p3bTarifSuggested = 20;
  } else if (d[1] !== null) {
    html += `Tarif P3B: <strong style="color:var(--accent2)">${d[0]}%</strong> (kepemilikan signifikan) / <strong style="color:var(--accent2)">${d[1]}%</strong> (lainnya)<br>`;
    if (d[2]) html += `<span style="color:#94a3b8;font-size:0.88rem;">â„¹ï¸ ${d[2]}</span><br>`;
    html += `<span style="color:#94a3b8;font-size:0.88rem;">vs tarif umum PPh 26: <s>20%</s> â€” penghematan ${20 - d[0]}%â€“${20 - d[1]}%</span>`;
    _p3bTarifSuggested = d[0]; // pakai tarif lebih rendah sebagai default
  } else {
    html += `Tarif P3B: <strong style="color:var(--accent2)">${d[0]}%</strong><br>`;
    if (d[2]) html += `<span style="color:#94a3b8;font-size:0.88rem;">â„¹ï¸ ${d[2]}</span><br>`;
    if (d[0] < 20) html += `<span style="color:#94a3b8;font-size:0.88rem;">vs tarif umum PPh 26: <s>20%</s> â€” penghematan ${20 - d[0]}%</span>`;
    else html += `<span style="color:#f87171;font-size:0.88rem;">Tarif P3B = tarif umum â€” tidak ada penghematan untuk jenis ini.</span>`;
    _p3bTarifSuggested = d[0];
  }

  infoEl.innerHTML = html;
  resEl.style.display = 'block';
}

function p3bPakaiTarif() {
  if (_p3bTarifSuggested === null) return;
  const negara = document.getElementById('p3b_negara').value;
  const jenis  = document.getElementById('p3b_jenis').value;
  const jenisLabel = { dividen:'Dividen', bunga:'Bunga/Royalti/Hadiah', royalti:'Royalti', jasa:'Imbalan Jasa', kapgain:'Capital Gain' }[jenis];

  // Pilih opsi custom di dropdown
  document.getElementById('p26_jenis').value = 'custom';
  document.getElementById('p26_custom_tarif').value = _p3bTarifSuggested;
  document.getElementById('p26_custom_wrap').style.display = 'block';

  // Tampilkan badge
  const badge = document.getElementById('p26_treaty_badge');
  badge.style.display = 'block';
  badge.innerHTML = `âœ… Menggunakan tarif P3B Indonesiaâ€“${negara}: <strong>${_p3bTarifSuggested}% (${jenisLabel})</strong>`;

  hitungP26();
  // Scroll ke kalkulatornya
  document.getElementById('p26_bruto').focus();
}

// â”€â”€ PPH 26 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function hitungP26() {
  const input  = parseFloat(document.getElementById('p26_bruto').value) || 0;
  const jenis  = document.getElementById('p26_jenis').value;
  const skema  = document.getElementById('p26_skema').value;

  const isCustom = jenis === 'custom';
  document.getElementById('p26_custom_wrap').style.display = isCustom ? 'block' : 'none';
  if (!isCustom) document.getElementById('p26_treaty_badge').style.display = 'none';

  let tarifPct = isCustom
    ? (parseFloat(document.getElementById('p26_custom_tarif').value) || 0)
    : 20;
  const tarif = tarifPct / 100;
  const tarifLabel = tarifPct + '%' + (isCustom ? ' (P3B)' : '');

  const isGrossUp = skema === 'gross_up';
  const isNetto   = skema === 'netto';

  document.getElementById('p26_tarif_info').textContent = 'Tarif: ' + tarifLabel;
  document.getElementById('p26_input_label').textContent = isGrossUp ? 'Nilai Neto yang Ingin Diterima WPLN (Rp)' : 'Penghasilan Bruto (Rp)';
  document.getElementById('p26_gu_icon').style.display  = isGrossUp ? 'inline-flex' : 'none';
  document.getElementById('p26_gu_box').style.display   = isGrossUp ? 'block' : 'none';
  document.getElementById('p26_netto_box').style.display = isNetto  ? 'block' : 'none';

  if (input === 0) { document.getElementById('resultP26').style.display = 'none'; return; }

  let bruto, pph, neto, totalBeban;
  if (isGrossUp) {
    neto = input; bruto = neto / (1 - tarif); pph = bruto - neto; totalBeban = bruto;
  } else if (isNetto) {
    bruto = input; pph = bruto * tarif; neto = bruto; totalBeban = bruto + pph;
  } else {
    bruto = input; pph = bruto * tarif; neto = bruto - pph; totalBeban = bruto;
  }

  const badge  = document.getElementById('p26_treaty_badge');
  const treaty = isCustom && badge.style.display !== 'none' ? badge.innerText.replace('âœ… ','') : '';
  const treatyRow = treaty ? [{ label: 'Dasar Tarif', value: treaty }] : [];

  let rows = [];
  if (isGrossUp) {
    rows = [
      ...treatyRow,
      { label: 'Nilai Neto yang Ingin Diterima WPLN', value: fmt(neto) },
      { label: `âœ¦ PPh 26 Gross Up (${tarifLabel})`,   value: fmt(pph) },
      { label: 'Penghasilan Bruto (setelah dinaikkan)',value: fmt(bruto) },
      { label: 'PPh 26 Dipotong',                      value: fmt(pph) },
      { label: 'Nilai Bersih Diterima WPLN',           value: fmt(neto), total: true },
    ];
  } else if (isNetto) {
    rows = [
      ...treatyRow,
      { label: 'Penghasilan Bruto',                    value: fmt(bruto) },
      { label: `PPh 26 (${tarifLabel}) â€” Ditanggung Pemberi`, value: fmt(pph) },
      { label: 'Nilai Bersih Diterima WPLN',           value: fmt(neto) },
      { label: 'Total Beban Pemberi (Bruto + PPh)',     value: fmt(totalBeban), total: true },
    ];
  } else {
    rows = [
      ...treatyRow,
      { label: 'Penghasilan Bruto',                    value: fmt(bruto) },
      { label: `PPh 26 (${tarifLabel}) â€” Dipotong dari WPLN`, value: fmt(pph) },
      { label: 'Nilai Bersih Diterima WPLN',           value: fmt(neto), total: true },
    ];
  }

  if (isCustom && tarifPct < 20) {
    rows.push({ label: `âœ¦ Penghematan vs Tarif Normal 20%`, value: fmt(bruto * 0.20 - pph) });
  }

  renderTable('tableP26', rows);
  document.getElementById('resultP26').style.display = 'block';
}
</script>

</body>
</html>
